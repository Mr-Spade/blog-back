<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>article</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: transparent;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
  </style>
  <script defer=""
  src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <link rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<p>感觉我正在日益沦为一个搬运工…</p>
<p>线性插值是指这样一个问题：给定整数<span
class="math inline">n,m</span>，以及一个<span
class="math inline">n</span>次多项式<span
class="math inline">f</span>在<span
class="math inline">0,1,2,\dots,n-1</span>处的点值，即<span
class="math inline">f(0),f(1),f(2),\dots,f(n-1)</span>，希望能在关于<span
class="math inline">n</span>的<strong>线性</strong>时间内求出<span
class="math inline">f(m)</span>。<span class="math inline">n\leq
10^6,m\leq 10^{18}</span>。</p>
<p>利用多项式多点插值并求一次点值可以做到<span
class="math inline">O(n\log^2n)</span>，但显然是过不去的。</p>
<p>我们考虑多项式<span
class="math inline">f</span>的牛顿级数，设其为<span
class="math inline">c</span>，即：</p>
<p><span class="math display">
\sum_{i=0}^{n-1}f_ix^i=\sum_{i=0}^{n-1}c_i{x\choose i}
</span></p>
<p>那么对于<span
class="math inline">m=0,1,2,\dots,n-1</span>，显然有：</p>
<p><span class="math display">
f(m)=\sum_{i=0}^{n-1}c_i{m\choose i}
</span></p>
<p>注意到当<span class="math inline">i\geq m</span>时<span
class="math inline">{m\choose i}</span>为<span
class="math inline">0</span>，于是修改求和上限：</p>
<p><span class="math display">
f(m)=\sum_{i=0}^mc_i{m\choose i}
</span></p>
<p>这就是经典的二项式反演的形式，于是我们就得到：</p>
<p><span class="math display">
c_i=\sum_{j=0}^i(-1)^{i-j}{i\choose j}f(j)
</span></p>
<p>进回带到求和上限为<span
class="math inline">n-1</span>的式中，于是有：</p>
<p><span class="math display">
f(m)=\sum_{i=0}^{n-1}\Bigg({m\choose i}\sum_{j=0}^i(-1)^{i-j}{i\choose
j}f(j)\Bigg)
</span></p>
<p>套路一波，将对<span class="math inline">j</span>的求和放到外面：</p>
<p><span class="math display">
f(m)=\sum_{j=0}^{n-1}\Bigg(f(j)\sum_{i=j}^{n-1}(-1)^{i-j}{m\choose
i}{i\choose j}\Bigg)
</span></p>
<p>为了直观，我们用<span class="math inline">i</span>替换<span
class="math inline">i-j</span>：</p>
<p><span class="math display">
f(m)=\sum_{j=0}^{n-1}\Bigg(f(j)\sum_{i=0}^{n-1-j}(-1)^i{m\choose
i+j}{i+j\choose j}\Bigg)
</span></p>
<p>利用<span class="math inline">{m\choose i+j}{i+j\choose j}={m\choose
j}{m-j\choose i}</span>进行替换，得到：</p>
<p><span class="math display">
f(m)=\sum_{j=0}^{n-1}\Bigg(f(j)\sum_{i=0}^{n-1-j}(-1)^i{m\choose
j}{m-j\choose i}\Bigg)
</span></p>
<p>于是<span class="math inline">{m\choose j}</span>可以放到前面：</p>
<p><span class="math display">
f(m)=\sum_{j=0}^{n-1}\Bigg(f(j){m\choose
j}\sum_{i=0}^{n-1-j}(-1)^i{m-j\choose i}\Bigg)
</span></p>
<p>现在考虑求出下面的式子的封闭形式：</p>
<p><span class="math display">
\sum_{i=0}^{n-1}(-1)^i{m\choose i}
</span></p>
<p>首先是应用上指标反转使<span class="math inline">(-1)^i{m\choose
i}={i-m-1\choose i}</span>：</p>
<p><span class="math display">
\sum_{i=0}^{n-1}{i-m-1\choose i}
</span></p>
<p>考虑加入一个数<span class="math inline">{-m-1\choose
-1}=0</span>：</p>
<p><span class="math display">
{-m-1\choose -1}+\sum_{i=0}^{n-1}{i-m-1\choose i}
</span></p>
<p>裂项：</p>
<p><span class="math display">
{-m-1\choose -1}+{-m-1\choose 0}+\sum_{i=1}^{n-1}{i-m-1\choose i}
</span></p>
<p><span class="math display">
{-m\choose 0}+\sum_{i=1}^{n-1}{i-m-1\choose i}
</span></p>
<p>一直重复，直到只剩下：</p>
<p><span class="math display">
{n-m-1\choose n-1}
</span></p>
<p>再进行上指标反转：</p>
<p><span class="math display">
(-1)^{n-1}{m-1\choose n-1}
</span></p>
<p>于是原式终于可以简化为：</p>
<p><span class="math display">
f(m)=\sum_{j=0}^{n-1}\Bigg(f(j){m\choose j}(-1)^{n-1-j}{m-1-j\choose
n-1-j}\Bigg)
</span></p>
<p>整理，得：</p>
<p><span class="math display">
f(m)=\sum_{i=0}^{n-1}(-1)^{n-1-i}{m\choose i}{m-1-i\choose n-1-i}f(i)
</span></p>
<p>用阶乘展开组合数：</p>
<p><span class="math display">
f(m)=\sum_{i=0}^{n-1}(-1)^{n-1-i}\frac{m!}{i!(m-i)!}\frac{(m-1-i)!}{(n-1-i)!(m-n)!}
f(i)
</span></p>
<p>继续整理：</p>
<p><span class="math display">
f(m)=m^{\underline
n}\sum_{i=0}^{n-1}\frac{(-1)^{n-1-i}}{(m-i)i!(n-1-i)!}f(i)
</span></p>
<p>于是就可以做了，<span
class="math inline">m-i</span>的逆元可以用与预处理阶乘逆元的类似方法做到线性。总复杂度是<span
class="math inline">O(n)</span>。</p>
<p><span class="math inline">\rm
upd</span>：被强大的姐姐打脸了…其实直接用拉格朗日插值公式即可推出和上面一样的东西…<del>所以这篇文章只是想说数学真奇妙。</del></p>
</body>
</html>
