<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>article</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: transparent;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
  </style>
  <script defer=""
  src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <link rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<p><a
href="https://codeforces.com/contest/1477/problem/F">好题！</a></p>
<p>题意：你有一条长为<span
class="math inline">L</span>的线段，初始时线段上已经有<span
class="math inline">n-1</span>个分割点将其划分为<span
class="math inline">n</span>段，其中第<span
class="math inline">i</span>段长为<span
class="math inline">l_i</span>。每次在<span
class="math inline">[0,L]</span>中随机一个实数<span
class="math inline">r</span>，在线段上加入坐标为<span
class="math inline">r</span>的分割点，直到所有分割点将线段分割为每段长度不超过<span
class="math inline">K</span>的若干段。求新加入的分割点个数的期望。模<span
class="math inline">998244353</span>。</p>
<p><span class="math inline">n\leq 50,L,K\leq 2000</span></p>
<p>题解：</p>
<p>令生成函数<span class="math inline">f</span>对应的指数生成函数为<span
class="math inline">\tilde f</span>。</p>
<p>首先考虑<span class="math inline">n=1</span>的情况。假设第<span
class="math inline">i</span>步及以内能够结束的概率为<span
class="math inline">p_i</span>，那么答案为<span
class="math inline">\sum_{i\geq 0}(1-p_i)</span>。考虑如何计算<span
class="math inline">p_i</span>。</p>
<p>显然，第<span
class="math inline">n</span>步及以内可以结束等价于无论是否达到要求强行做到第<span
class="math inline">n</span>步，此时符合要求。考虑每一步的随机都是独立的，那么随机生成的坐标点列<span
class="math inline">(z_1,z_2,\dots,z_n)</span>是均匀分布在<span
class="math inline">\Omega_L=\{(z_1,z_2,\dots,z_n)|0\leq z_i\leq
L,i=1,2,\dots,n\}</span>中的，每一个特定的坐标点列<span
class="math inline">(z_1,z_2,\dots,z_n)</span>被生成的概率元为：</p>
<p><span class="math display">
\frac{\mathrm{d}z}{\idotsint_{\Omega_L}\mathrm{d}z}=\frac{\mathrm{d}z}{L^n}
</span></p>
<p>但从<span
class="math inline">(z_1,z_2,\dots,z_n)</span>中无法很好地分析是否满足<span
class="math inline">\leq K</span>的要求，考虑对该空间进行转化。在<span
class="math inline">\Omega_L</span>中的点坐标几乎都是两两不同的，将其排序，转化为<span
class="math inline">(\hat z_1,\hat z_2,\dots,\hat z_n)</span>，其中<span
class="math inline">0\leq \hat z_1\leq \hat z_2\leq \cdots\leq \hat
z_n\leq L</span>，令<span class="math inline">\hat \Omega_L=\{(\hat
z_1,\hat z_2,\dots,\hat z_n)|0\leq \hat z_1\leq \hat z_2\leq \cdots\leq
\hat z_n\leq L\}</span>，则<span class="math inline">\hat
\Omega_L</span>中的每个点几乎都对应<span
class="math inline">n!</span>个<span
class="math inline">\Omega_L</span>中的点，于是每个<span
class="math inline">\hat\Omega_L</span>中的点的概率元为<span
class="math inline">\frac{n!\mathrm{d}z}{L^n}</span>。</p>
<p>为了判断是否满足要求，进一步将<span class="math inline">(\hat
z_1,\hat z_2,\dots,\hat z_n)</span>唯一对应到其差分数组<span
class="math inline">(\hat z_1,\hat z_2-\hat z_1,\dots,\hat z_n-\hat
z_{n-1})</span>，均匀分布在空间<span class="math inline">\tilde
\Omega_L=\{(\tilde z_1,\tilde z_2,\dots,\tilde z_n)|\tilde z_i\geq
0,\sum_{i=1}^n\tilde z_i\leq L\}</span>中，每个点的概率元仍然为<span
class="math inline">\frac{n!\mathrm{d}z}{L^n}</span>。顺便说明，这证明了<span
class="math inline">\idotsint_{\tilde
\Omega_L}\mathrm{d}z=\frac{L^n}{n!}</span>。</p>
<p>于是在<span class="math inline">\tilde \Omega_L</span>中，<span
class="math inline">(\tilde z_1,\tilde z_2,\dots,\tilde
z_n)</span>符合要求等价于<span class="math inline">0\leq \tilde z_i\leq
K,i=1,2,\dots,n</span>且<span class="math inline">0\leq
L-\sum_{i=1}^nz_i\leq K</span>，于是我们有符合要求的概率等于<span
class="math inline">\Omega_K\cap(\tilde \Omega_L\setminus\tilde
\Omega_{L-K})</span>中的点的概率元的和，即：</p>
<p><span class="math display">
p_n=\idotsint_{\Omega_K\cap(\tilde \Omega_L\setminus\tilde
\Omega_{L-K})}\frac{n!\mathrm{d}z}{L^n}=\frac{n!}{L^n}\Bigg(\idotsint_{\Omega_K\cap\tilde
\Omega_L}\mathrm{d}z-\idotsint_{\Omega_K\cap\tilde
\Omega_{L-K}}\mathrm{d}z\Bigg)
</span></p>
<p>现在关注如何求出<span
class="math inline">\idotsint_{\Omega_A\cap\tilde
\Omega_B}\mathrm{d}z</span>，定义<strong>可重集</strong><span
class="math inline">\Phi_{A,S}=\{(z_1,z_2,\dots,z_n)|z_i\geq A,i\in
S,z_i\geq 0,i\not\in S\}</span>。</p>
<p>容斥<span class="math inline">\Omega_A</span>中<span
class="math inline">z_t\leq A</span>的限制，就可以将<span
class="math inline">\Omega_A</span>几乎完全地用若干个<span
class="math inline">\Phi_{A,S}</span>表示出来（除若干边界上的点以外）：</p>
<p><span class="math display">
\Omega_A=\sum_{S\subseteq\{1,2,\dots,n\}}(-1)^{|S|}\Phi_{A,S}
</span></p>
<p>于是：</p>
<p><span class="math display">
\idotsint_{\Omega_A\cap\tilde
\Omega_B}\mathrm{d}z=\sum_{S\subseteq\{1,2,\dots,n\}}(-1)^{|S|}\idotsint_{\Phi_{A,S}\cap\tilde
\Omega_B}\mathrm{d}z
</span></p>
<p>而对于<span class="math inline">\Phi_{A,S}\cap\tilde
\Omega_B</span>中的点<span
class="math inline">(z_1,z_2,\dots,z_n)</span>，可以将满足<span
class="math inline">i\in S</span>的<span
class="math inline">z_i</span>减去<span
class="math inline">A</span>，从而与<span class="math inline">\tilde
\Omega_{B-|S|A}</span>中的点一一对应，于是<span
class="math inline">\Phi_{A,S}\cap\tilde \Omega_B</span>与<span
class="math inline">\tilde
\Omega_{B-|S|A}</span>的积分相等，由前文证明的结论可以得到：</p>
<p><span class="math display">
\idotsint_{\Omega_A\cap\tilde
\Omega_B}\mathrm{d}z=\sum_{S\subseteq\{1,2,\dots,n\}}(-1)^{|S|}\idotsint_{\tilde
\Omega_{B-|S|A}}\mathrm{d}z
</span></p>
<p><span class="math display">
=\sum_{i=0}^n(-1)^{i}{n\choose i}\idotsint_{\tilde
\Omega_{B-iA}}\mathrm{d}z=\sum_{i=0}^{\lfloor\frac{B}{A}\rfloor}(-1)^i{n\choose
i}\frac{(B-iA)^n}{n!}
</span></p>
<p>回代到<span class="math inline">p_n</span>的表达式中，可以得到：</p>
<p><span class="math display">
p_n=\frac{n!}{L^n}\Bigg(\sum_{i=0}^{\lfloor\frac{L}{K}\rfloor}(-1)^i{n\choose
i}\frac{(L-iK)^n}{n!}-\sum_{i=0}^{\lfloor\frac{L}{K}\rfloor-1}(-1)^i{n\choose
i}\frac{(L-(i+1)K)^n}{n!}\Bigg)
</span></p>
<p><span class="math display">
=\sum_{i=0}^{\lfloor\frac{L}{K}\rfloor}(-1)^i{n\choose
i}\Big(1-i\frac{K}{L}\Big)^n+\sum_{i=1}^{\lfloor\frac{L}{K}\rfloor}(-1)^i{n\choose
i-1}\Big(1-i\frac{K}{L}\Big)^n
</span></p>
<p><span class="math display">
=1+\sum_{i=1}^{\lfloor\frac{L}{K}\rfloor}(-1)^i{n+1\choose
i}\Big(1-i\frac{K}{L}\Big)^n
</span></p>
<p>于是没有初始分割点的答案就为<span class="math inline">\sum_{i\geq
0}\sum_{j=1}^{\lfloor\frac{L}{K}\rfloor}(-1)^{j+1}{i+1\choose
j}\Big(1-j\frac{K}{L}\Big)^i</span>，下面考虑存在初始分割点的情况。</p>
<p>定义<span
class="math inline">q_{i,j}=1+\sum_{k=1}^{\lfloor\frac{l_i}{K}\rfloor}(-1)^k{j+1\choose
k}\Big(1-k\frac{K}{l_i}\Big)^j</span>，<span
class="math inline">Q_i=\sum_{k\geq
0}q_{i,k}\Big(\frac{l_i}{L}\Big)^kx^k</span>，<span
class="math inline">p_i</span>仍然如上定义，<span
class="math inline">P=\sum_{k\geq 0}p_kx^k</span>，则此时<span
class="math inline">p_i</span>的值为：</p>
<p><span class="math display">
p_i=\sum_{k_1+k_2+\dots+k_n=i}{i\choose
k_1,k_2,\dots,k_n}\prod_{j=1}^n\Big(\frac{l_j}{L}\Big)^{k_j}q_{j,k_j}
</span></p>
<p><span class="math display">
\frac{p_i}{i!}=\sum_{k_1+k_2+\dots+k_n=i}\prod_{j=1}^n\frac{\Big(\frac{l_j}{L}\Big)^{k_j}q_{j,k_j}}{k_j!}
</span></p>
<p>即：</p>
<p><span class="math display">
\tilde P=\prod_{i=1}^n\tilde Q_i
</span></p>
<p>我们要求的答案是<span class="math inline">\sum_{k\geq
0}(1-k![x^k]\tilde P)=\sum_{k\geq 0}k![x^k](e^x-\tilde
P)</span>，那么首先考虑<span class="math inline">\tilde
Q_i</span>的表达式：</p>
<p><span class="math display">
\tilde Q_i=\sum_{j\geq
0}\frac{1}{j!}\Bigg(1+\sum_{k=1}^{\lfloor\frac{l_i}{K}\rfloor}(-1)^k{j+1\choose
k}\Big(1-k\frac{K}{l_i}\Big)^j\Bigg)\Big(\frac{l_i}{L}\Big)^jx^j
</span></p>
<p><span class="math display">
=\sum_{j\geq 0}\frac{1}{j!}\Big(\frac{l_i}{L}\Big)^jx^j+\sum_{j\geq
0}\frac{1}{j!}\sum_{k=1}^{\lfloor\frac{l_i}{K}\rfloor}(-1)^k{j+1\choose
k}\Big(\frac{l_i-kK}{L}\Big)^jx^j
</span></p>
<p><span class="math display">
=e^{\frac{l_i}{L}x}+\sum_{j\geq
0}\sum_{k=1}^{\min\{j+1,\lfloor\frac{l_i}{K}\rfloor\}}(-1)^k\frac{j+1}{k!(j+1-k)!}\Big(\frac{l_i-kK}{L}\Big)^jx^j
</span></p>
<p><span class="math display">
=e^{\frac{l_i}{L}x}+\sum_{j\geq
0}\sum_{k=1}^{\min\{j+1,\lfloor\frac{l_i}{K}\rfloor\}}(-1)^k\frac{j+1-k+k}{k!(j+1-k)!}\Big(\frac{l_i-kK}{L}\Big)^jx^j
</span></p>
<p><span class="math display">
=e^{\frac{l_i}{L}x}+\sum_{j\geq
0}\sum_{k=1}^{\min\{j,\lfloor\frac{l_i}{K}\rfloor\}}(-1)^k\frac{1}{k!(j-k)!}\Big(\frac{l_i-kK}{L}\Big)^jx^j+\sum_{j\geq
0}\sum_{k=1}^{\min\{j+1,\lfloor\frac{l_i}{K}\rfloor\}}(-1)^k\frac{1}{(k-1)!(j+1-k)!}\Big(\frac{l_i-kK}{L}\Big)^jx^j
</span></p>
<p><span class="math display">
=e^{\frac{l_i}{L}x}+\sum_{k=1}^{\lfloor\frac{l_i}{K}\rfloor}\frac{(-1)^k}{k!}\sum_{j\geq
k}\frac{\Big(\frac{l_i-kK}{L}\Big)^j}{(j-k)!}x^j+\sum_{k=1}^{\lfloor\frac{l_i}{K}\rfloor}\frac{(-1)^k}{(k-1)!}\sum_{j\geq
k-1}\frac{\Big(\frac{l_i-kK}{L}\Big)^j}{(j-(k-1))!}x^j
</span></p>
<p><span class="math display">
=e^{\frac{l_i}{L}x}+\sum_{k=1}^{\lfloor\frac{l_i}{K}\rfloor}\frac{(-1)^k\Big(\frac{l_i-kK}{L}\Big)^kx^k}{k!}\sum_{j\geq
0}\frac{\Big(\frac{l_i-kK}{L}\Big)^j}{j!}x^j+\sum_{k=1}^{\lfloor\frac{l_i}{K}\rfloor}\frac{(-1)^k\Big(\frac{l_i-kK}{L}\Big)^{k-1}x^{k-1}}{(k-1)!}\sum_{j\geq
0}\frac{\Big(\frac{l_i-kK}{L}\Big)^j}{j!}x^j
</span></p>
<p><span class="math display">
=e^{\frac{l_i}{L}x}+\sum_{k=1}^{\lfloor\frac{l_i}{K}\rfloor}\frac{(-1)^k\Big(\frac{l_i-kK}{L}\Big)^kx^k}{k!}e^{\Big(\frac{l_i-kK}{L}\Big)x}+\sum_{k=1}^{\lfloor\frac{l_i}{K}\rfloor}\frac{(-1)^k\Big(\frac{l_i-kK}{L}\Big)^{k-1}x^{k-1}}{(k-1)!}e^{\Big(\frac{l_i-kK}{L}\Big)x}
</span></p>
<p><span class="math display">
=e^{\frac{l_i}{L}x}\Bigg(1+\sum_{k=1}^{\lfloor\frac{l_i}{K}\rfloor}\frac{(-1)^k\Big(\frac{l_i-kK}{L}\Big)^k}{k!}x^ke^{-k\frac{K}{L}x}+\sum_{k=1}^{\lfloor\frac{l_i}{K}\rfloor}\frac{(-1)^k\Big(\frac{l_i-kK}{L}\Big)^{k-1}}{(k-1)!}x^{k-1}e^{-k\frac{K}{L}x}\Bigg)
</span></p>
<p>括号外的部分全部相乘，即为<span
class="math inline">e^x</span>，考虑括号内的部分，可以发现相乘之后可以表示为若干项<span
class="math inline">x^{k-j}e^{-k\frac{K}{L}x}</span>的线性组合，于是可以利用以<span
class="math inline">j,k</span>为下标的二维卷积计算每一项的系数，就得到了<span
class="math inline">e^x-\tilde P</span>的一个以若干项<span
class="math inline">x^ke^{Cx}</span>的线性组合表示的表达式。</p>
<p>最后，只需要考虑如何计算<span class="math inline">\sum_{i\geq
0}i![x^i](x^ke^{Cx})</span>即可。考虑：</p>
<p><span class="math display">
\sum_{i\geq 0}i![x^i](x^ke^{Cx})=\sum_{i\geq
0}(i+k)!\frac{C^i}{i!}=k!\sum_{i\geq 0}{i+k\choose i}C^i
</span></p>
<p>令<span class="math inline">F_k=\sum_{i\geq 0}{i+k\choose
i}C^i</span>，于是：</p>
<p><span class="math display">
F_k=\sum_{i\geq 0}{i+k\choose i}C^i=\sum_{i\geq 0}\Bigg({i+k-1\choose
i-1}+{i+k-1\choose i}\Bigg)C^i
</span></p>
<p><span class="math display">
=\sum_{i\geq 1}{i-1+k\choose i-1}C^i+\sum_{i\geq 0}{i+k-1\choose i}C^i
</span></p>
<p><span class="math display">
=C\cdot F_k+F_{k-1}
</span></p>
<p>又<span class="math inline">F_0=\frac{1}{1-C}</span>，于是<span
class="math inline">F_k=\frac{1}{(1-C)^{k+1}}</span>，有<span
class="math inline">\sum_{i\geq
0}i![x^i](x^ke^{Cx})=\frac{k!}{(1-C)^{k+1}}</span>。</p>
<p>利用前文的分析，用分治<span class="math inline">\rm
FFT</span>计算二维卷积，可以在<span class="math inline">O(nL\log
nL)</span>的时间内解决问题。最后记得处理边界条件，如<span
class="math inline">K=l_i</span>的情况可能要令<span
class="math inline">0^0=0</span>。</p>
</body>
</html>
