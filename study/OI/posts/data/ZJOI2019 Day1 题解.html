<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>article</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: transparent;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <script defer=""
  src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <link rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<p>想要继续向前，就从克服内心的恐惧开始。</p>
<h3 id="麻将">麻将</h3>
<h5 id="题意">题意</h5>
<p>在麻将中，我们称点数连续的三张牌或三张点数一样的成为面子，称两张点数一样的牌为对子。一副十四张麻将牌的胡牌条件是可以分成四个面子和一个对子或者分成七个互不相同的对子。现在规定麻将牌的点数为<span
class="math inline">1\sim
n</span>，每种点数都有四张牌。现在给出你初始的十三张手牌，假设剩余的牌以随机的顺序发到你的手上，求期望发多少张牌以后你的手牌中存在一组牌可以胡牌。注意点数相同的牌两两之间也视为不同的。<span
class="math inline">5\leq n\leq 100</span>。答案对<span
class="math inline">998244353</span>取模。</p>
<h5 id="题解">题解</h5>
<p>首先对题目要求的期望进行转化。假设<span
class="math inline">p_i</span>表示发了<span
class="math inline">i</span>张牌以后依然没有能够胡的一组牌的概率，那么答案等价于<span
class="math inline">\sum_{i=0}^{4n-13}p_i</span>，这是通过将贡献分步计算得出的。</p>
<p>那么考虑将概率转化为更好算的方案数，最后只要令<span
class="math inline">p_i</span>除以<span
class="math inline">{4n-13\choose i}i!</span>，即放牌的方案数即可。</p>
<p>那么如何在给定一副牌的情况下，判段它是否存在一个子集是否可以胡牌呢？</p>
<p>我们可以用一个简单的<span
class="math inline">dp</span>来表示这个过程。对于七个对子的情况，只需记<span
class="math inline">cnt_i</span>表示点数<span class="math inline">\leq
i</span>的牌中牌数<span class="math inline">\geq
2</span>的点数数量即可。对于四个面子加一个对子的情况，我们记<span
class="math inline">f_{i,0/1,j,k}</span>表示只考虑点数<span
class="math inline">\leq i</span>的牌，在是否加了对子，准备组成<span
class="math inline">j</span>副形如<span
class="math inline">i-1,i,i+1</span>的面子和<span
class="math inline">k</span>副形如<span
class="math inline">i,i+1,i+2</span>的面子的情况下，剩下的牌最多能够组成多少面子。（如果当前已经没有足够的牌满足这个要求，那么设为<span
class="math inline">-1</span>即可）。</p>
<p>考虑组成了<span
class="math inline">3</span>副点数连续的面子的情况，这可以拆成三副点数相同的面子，因此上面的<span
class="math inline">f</span>数组中的<span
class="math inline">j,k</span>的上界设为<span
class="math inline">2</span>就够了。又可以发现因为只需要<span
class="math inline">4</span>个面子，因此所有<span
class="math inline">f_{i,0/1,j,k}</span>的值都可以对<span
class="math inline">4</span>取<span
class="math inline">\min</span>，同理<span
class="math inline">cnt_i</span>可以对<span
class="math inline">7</span>取<span
class="math inline">\min</span>。同时可以发现判断一个状态是否可以胡牌也是很简单的，只需要看是否有<span
class="math inline">f_{i,0/1,j,k}=4</span>或者<span
class="math inline">cnt_i=7</span>即可。</p>
<p>考虑这个状态的转移，可以枚举点数为<span
class="math inline">i+1</span>的牌数,设为<span
class="math inline">c</span>，则<span
class="math inline">f_{i+1,0,j,k}</span>可以通过合法的<span
class="math inline">f_{i,0,l,j}+l+\lfloor\frac{c-l-j-k}{3}\rfloor</span>转移过来，<span
class="math inline">f_{i+1,1,j,k}</span>可以通过合法的<span
class="math inline">f_{i,1,l,j}+l+\lfloor\frac{c-l-j-k}{3}\rfloor</span>转移过来，如果将点数为<span
class="math inline">i+1</span>的取出两张做对子，<span
class="math inline">f_{i+1,1,j,k}</span>也可以通过合法的<span
class="math inline">f_{i,0,l,j}+l+\lfloor\frac{c-2-l-j-k}{3}\rfloor</span>转移过来。<span
class="math inline">cnt</span>的转移则更简单,只要令<span
class="math inline">cnt_{i+1}=cnt_i+[c\geq 2]</span>就可以了。</p>
<p>我们可以发现，状态的转移和<span
class="math inline">i</span>没有任何关系，只要知道了<span
class="math inline">f_i</span>的共<span class="math inline">2\times
3\times 3=18</span>个数、<span
class="math inline">cnt_i</span>以及下一种点数的牌数，我们就可以得到<span
class="math inline">f_{i+1}</span>以及<span
class="math inline">cnt_{i+1}</span>。于是我们不妨将某种确定的<span
class="math inline">f_i</span>和<span
class="math inline">cnt_i</span>打包为一个结构体<span
class="math inline">cell</span>。在发现<span
class="math inline">cell</span>的状态十分简洁，并且每个数的取值都是有上下界的以后，我们不禁想到：合法的<span
class="math inline">cell</span>的数量会不会非常有限呢？为了验证这一点，我们可以从空状态开始，每次枚举下一种点数的牌数，就可以得到它的所有后继状态。我们可以进行一次<span
class="math inline">bfs</span>（可以用<span
class="math inline">set</span>判重）以找出所有空状态可以到达的状态。</p>
<p>最终我们可以发现，合法的状态一共有<span
class="math inline">3956</span>个。你可以用这个数字来检验程序的正确性。</p>
<p>既然状态数这么少，那么我们不妨预处理好所有的状态对应的转移。为了减小常数，我们不妨对每个不同的状态标一下号。于是我们就可以预处理数组<span
class="math inline">trans</span>，其中<span
class="math inline">trans_{x,i}</span>表示在标号为<span
class="math inline">x</span>的状态下，如果下一种点数的牌数为<span
class="math inline">i</span>，将会转移到标号为多少的状态。同时预处理数组<span
class="math inline">book</span>，其中<span
class="math inline">book_x</span>表示状态<span
class="math inline">x</span>是否可以胡牌。</p>
<p>最终我们就可以计算数组<span
class="math inline">p</span>了，这可以通过一个“更大”的<span
class="math inline">dp</span>来实现。我们设<span
class="math inline">g_{i,j,k}</span>表示只考虑点数<span
class="math inline">\leq i</span>的牌，当前的状态标号为<span
class="math inline">j</span>，点数<span class="math inline">\leq
i</span>的牌中除了初始给定的牌以外还选了<span
class="math inline">k</span>张牌的方案数。不难发现<span
class="math inline">p_k=\sum_{book_j=0}g_{n,j,k}</span>。</p>
<p>我们设<span class="math inline">cnt_i</span>（注意这和之前的<span
class="math inline">cnt</span>完全没关系）表示初始时刻你的手牌中点数为<span
class="math inline">i</span>的牌的数量，来考虑大<span
class="math inline">dp</span>的转移。可以发现我们有：</p>
<p><span class="math display">
g_{i,j,k}{4-cnt_{i+1}\choose c}c!{k+c\choose c}\to
g_{i+1,trans_{j,cnt_{i+1}+c},k+c}
</span></p>
<p>这样的关系，左边的系数的组合意义为，确定哪些牌作为拿到的牌，并决定这些牌的相对顺序，最后用隔板法插入到已有的牌中。</p>
<p>最终我们就得到了答案。复杂度是<span
class="math inline">O(3956*n^2)</span>，可以通过本题。实现的时候为了节省空间大<span
class="math inline">dp</span>可以使用滚动数组。</p>
<p>代码：</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co">There is no end though there is a start in space. ---Infinity.</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co">It has own power, it ruins, and it goes though there is a start also in the star. ---Finite.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">Only the person who was wisdom can read the most foolish one from the history.</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">The fish that lives in the sea doesn&#39;t know the world in the land. </span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">It also ruins and goes if they have wisdom.</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co">It is funnier that man exceeds the speed of light than fish start living in the land.</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co">It can be said that this is an final ultimatum from the god to the people who can fight.</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span> </span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="pp">#include</span><span class="im">&lt;cstdio&gt;</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="pp">#include</span><span class="im">&lt;cstring&gt;</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="pp">#include</span><span class="im">&lt;algorithm&gt;</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="pp">#include</span><span class="im">&lt;map&gt;</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="pp">#include</span><span class="im">&lt;queue&gt;</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="bu">std::</span>max<span class="op">;</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="bu">std::</span>min<span class="op">;</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="bu">std::</span>map<span class="op">;</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="bu">std::</span>queue<span class="op">;</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="at">const</span> <span class="dt">int</span> mod<span class="op">=</span><span class="dv">998244353</span><span class="op">;</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="kw">inline</span> <span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span><span class="dt">int</span> b<span class="op">)</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">(</span>a<span class="op">+=</span>b<span class="op">)&gt;=</span>mod<span class="op">?</span>a<span class="op">-</span>mod<span class="op">:</span>a<span class="op">;</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="kw">inline</span> <span class="dt">int</span> sub<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span><span class="dt">int</span> b<span class="op">)</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">(</span>a<span class="op">-=</span>b<span class="op">)&lt;</span><span class="dv">0</span><span class="op">?</span>a<span class="op">+</span>mod<span class="op">:</span>a<span class="op">;</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="kw">inline</span> <span class="dt">int</span> mul<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span><span class="dt">int</span> b<span class="op">)</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">(</span><span class="dt">long</span> <span class="dt">long</span><span class="op">)</span>a<span class="op">*</span>b<span class="op">%</span>mod<span class="op">;</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="kw">inline</span> <span class="dt">int</span> qpow<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span><span class="dt">int</span> b<span class="op">)</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> res<span class="op">=</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(;</span>b<span class="op">;</span>a<span class="op">=</span>mul<span class="op">(</span>a<span class="op">,</span>a<span class="op">),</span>b<span class="op">&gt;&gt;=</span><span class="dv">1</span><span class="op">)</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span><span class="op">(</span>b<span class="op">&amp;</span><span class="dv">1</span><span class="op">)</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>            res<span class="op">=</span>mul<span class="op">(</span>res<span class="op">,</span>a<span class="op">);</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> res<span class="op">;</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> epc</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> a<span class="op">[</span><span class="dv">2</span><span class="op">][</span><span class="dv">3</span><span class="op">][</span><span class="dv">3</span><span class="op">];</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> cnt<span class="op">;</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>    epc<span class="op">()</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>        memset<span class="op">(</span>a<span class="op">,-</span><span class="dv">1</span><span class="op">,</span><span class="kw">sizeof</span><span class="op">(</span>a<span class="op">));</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>        a<span class="op">[</span><span class="dv">0</span><span class="op">][</span><span class="dv">0</span><span class="op">][</span><span class="dv">0</span><span class="op">]=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>        cnt<span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span><span class="op">;</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>    <span class="kw">inline</span> <span class="dt">bool</span> <span class="kw">operator</span><span class="op">&lt;(</span><span class="at">const</span> epc <span class="op">&amp;</span>th<span class="op">)</span> <span class="at">const</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>        <span class="at">register</span> <span class="dt">int</span> i<span class="op">,</span>j<span class="op">,</span>k<span class="op">;</span></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span><span class="op">(</span>i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span><span class="dv">2</span><span class="op">;</span>i<span class="op">++)</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span><span class="op">(</span>j<span class="op">=</span><span class="dv">0</span><span class="op">;</span>j<span class="op">&lt;</span><span class="dv">3</span><span class="op">;</span>j<span class="op">++)</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span><span class="op">(</span>k<span class="op">=</span><span class="dv">0</span><span class="op">;</span>k<span class="op">&lt;</span><span class="dv">3</span><span class="op">;</span>k<span class="op">++)</span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span><span class="op">(</span>a<span class="op">[</span>i<span class="op">][</span>j<span class="op">][</span>k<span class="op">]!=</span>th<span class="op">.</span>a<span class="op">[</span>i<span class="op">][</span>j<span class="op">][</span>k<span class="op">])</span></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">return</span> a<span class="op">[</span>i<span class="op">][</span>j<span class="op">][</span>k<span class="op">]&lt;</span>th<span class="op">.</span>a<span class="op">[</span>i<span class="op">][</span>j<span class="op">][</span>k<span class="op">];</span></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> cnt<span class="op">&lt;</span>th<span class="op">.</span>cnt<span class="op">;</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>    <span class="kw">inline</span> epc trans<span class="op">(</span><span class="dt">int</span> c<span class="op">)</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>        <span class="at">register</span> <span class="dt">int</span> i<span class="op">,</span>j<span class="op">,</span>k<span class="op">;</span></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>        epc res<span class="op">;</span></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>        memset<span class="op">(</span>res<span class="op">.</span>a<span class="op">,-</span><span class="dv">1</span><span class="op">,</span><span class="kw">sizeof</span><span class="op">(</span>res<span class="op">.</span>a<span class="op">));</span></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>        res<span class="op">.</span>cnt<span class="op">=</span>cnt<span class="op">+(</span>c<span class="op">&gt;=</span><span class="dv">2</span><span class="op">);</span></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>        res<span class="op">.</span>cnt<span class="op">=</span>min<span class="op">(</span>res<span class="op">.</span>cnt<span class="op">,</span><span class="dv">7</span><span class="op">);</span></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span><span class="op">(</span>i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span><span class="dv">3</span><span class="op">;</span>i<span class="op">++)</span></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span><span class="op">(</span>j<span class="op">=</span><span class="dv">0</span><span class="op">;</span>j<span class="op">&lt;</span><span class="dv">3</span><span class="op">;</span>j<span class="op">++)</span></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span><span class="op">(</span>k<span class="op">=</span><span class="dv">0</span><span class="op">;</span>k<span class="op">&lt;</span><span class="dv">3</span><span class="op">;</span>k<span class="op">++)</span></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span><span class="op">(</span>k<span class="op">+</span>i<span class="op">+</span>j<span class="op">&lt;=</span>c<span class="op">)</span></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>                    <span class="op">{</span></span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span><span class="op">(</span>a<span class="op">[</span><span class="dv">0</span><span class="op">][</span>k<span class="op">][</span>i<span class="op">]!=-</span><span class="dv">1</span><span class="op">)</span></span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>                            res<span class="op">.</span>a<span class="op">[</span><span class="dv">0</span><span class="op">][</span>i<span class="op">][</span>j<span class="op">]=</span>max<span class="op">(</span>res<span class="op">.</span>a<span class="op">[</span><span class="dv">0</span><span class="op">][</span>i<span class="op">][</span>j<span class="op">],</span>a<span class="op">[</span><span class="dv">0</span><span class="op">][</span>k<span class="op">][</span>i<span class="op">]+</span>k<span class="op">+(</span>c<span class="op">-(</span>k<span class="op">+</span>i<span class="op">+</span>j<span class="op">))/</span><span class="dv">3</span><span class="op">);</span></span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span><span class="op">(</span>a<span class="op">[</span><span class="dv">1</span><span class="op">][</span>k<span class="op">][</span>i<span class="op">]!=-</span><span class="dv">1</span><span class="op">)</span></span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>                            res<span class="op">.</span>a<span class="op">[</span><span class="dv">1</span><span class="op">][</span>i<span class="op">][</span>j<span class="op">]=</span>max<span class="op">(</span>res<span class="op">.</span>a<span class="op">[</span><span class="dv">1</span><span class="op">][</span>i<span class="op">][</span>j<span class="op">],</span>a<span class="op">[</span><span class="dv">1</span><span class="op">][</span>k<span class="op">][</span>i<span class="op">]+</span>k<span class="op">+(</span>c<span class="op">-(</span>k<span class="op">+</span>i<span class="op">+</span>j<span class="op">))/</span><span class="dv">3</span><span class="op">);</span></span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>                    <span class="op">}</span></span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span><span class="op">(</span>c<span class="op">&gt;=</span><span class="dv">2</span><span class="op">)</span></span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span><span class="op">(</span>i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span><span class="dv">3</span><span class="op">;</span>i<span class="op">++)</span></span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span><span class="op">(</span>j<span class="op">=</span><span class="dv">0</span><span class="op">;</span>j<span class="op">&lt;</span><span class="dv">3</span><span class="op">;</span>j<span class="op">++)</span></span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span><span class="op">(</span>k<span class="op">=</span><span class="dv">0</span><span class="op">;</span>k<span class="op">&lt;</span><span class="dv">3</span><span class="op">;</span>k<span class="op">++)</span></span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span><span class="op">(</span>k<span class="op">+</span>i<span class="op">+</span>j<span class="op">&lt;=</span>c<span class="op">-</span><span class="dv">2</span><span class="op">&amp;&amp;</span>a<span class="op">[</span><span class="dv">0</span><span class="op">][</span>k<span class="op">][</span>i<span class="op">]!=-</span><span class="dv">1</span><span class="op">)</span></span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>                            res<span class="op">.</span>a<span class="op">[</span><span class="dv">1</span><span class="op">][</span>i<span class="op">][</span>j<span class="op">]=</span>max<span class="op">(</span>res<span class="op">.</span>a<span class="op">[</span><span class="dv">1</span><span class="op">][</span>i<span class="op">][</span>j<span class="op">],</span>a<span class="op">[</span><span class="dv">0</span><span class="op">][</span>k<span class="op">][</span>i<span class="op">]+</span>k<span class="op">+(</span>c<span class="op">-</span><span class="dv">2</span><span class="op">-(</span>k<span class="op">+</span>i<span class="op">+</span>j<span class="op">))/</span><span class="dv">3</span><span class="op">);</span></span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span><span class="op">(</span>i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span><span class="dv">2</span><span class="op">;</span>i<span class="op">++)</span></span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span><span class="op">(</span>j<span class="op">=</span><span class="dv">0</span><span class="op">;</span>j<span class="op">&lt;</span><span class="dv">3</span><span class="op">;</span>j<span class="op">++)</span></span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span><span class="op">(</span>k<span class="op">=</span><span class="dv">0</span><span class="op">;</span>k<span class="op">&lt;</span><span class="dv">3</span><span class="op">;</span>k<span class="op">++)</span></span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>                    res<span class="op">.</span>a<span class="op">[</span>i<span class="op">][</span>j<span class="op">][</span>k<span class="op">]=</span>min<span class="op">(</span>res<span class="op">.</span>a<span class="op">[</span>i<span class="op">][</span>j<span class="op">][</span>k<span class="op">],</span><span class="dv">4</span><span class="op">);</span></span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> res<span class="op">;</span></span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>    <span class="kw">inline</span> <span class="dt">bool</span> win<span class="op">()</span></span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>        <span class="dt">bool</span> f<span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>        <span class="at">register</span> <span class="dt">int</span> i<span class="op">,</span>j<span class="op">;</span></span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span><span class="op">(</span>i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span><span class="dv">3</span><span class="op">;</span>i<span class="op">++)</span></span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span><span class="op">(</span>j<span class="op">=</span><span class="dv">0</span><span class="op">;</span>j<span class="op">&lt;</span><span class="dv">3</span><span class="op">;</span>j<span class="op">++)</span></span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>                f<span class="op">|=</span>a<span class="op">[</span><span class="dv">1</span><span class="op">][</span>i<span class="op">][</span>j<span class="op">]==</span><span class="dv">4</span><span class="op">;</span></span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a>        f<span class="op">|=</span>cnt<span class="op">==</span><span class="dv">7</span><span class="op">;</span></span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> f<span class="op">;</span></span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a><span class="at">const</span> <span class="dt">int</span> M<span class="op">=</span><span class="dv">4005</span><span class="op">;</span></span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a>map<span class="op">&lt;</span>epc<span class="op">,</span><span class="dt">int</span><span class="op">&gt;</span> id<span class="op">;</span></span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> tot<span class="op">;</span></span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> trans<span class="op">[</span>M<span class="op">][</span><span class="dv">5</span><span class="op">];</span></span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a><span class="dt">bool</span> book<span class="op">[</span>M<span class="op">];</span></span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a>queue<span class="op">&lt;</span>epc<span class="op">&gt;</span> Q<span class="op">;</span></span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a><span class="kw">inline</span> <span class="dt">void</span> bfs<span class="op">()</span></span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a>    epc x<span class="op">,</span>y<span class="op">;</span></span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a>    <span class="at">register</span> <span class="dt">int</span> i<span class="op">;</span></span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a>    id<span class="op">[</span>epc<span class="op">()]=++</span>tot<span class="op">;</span>book<span class="op">[</span>tot<span class="op">]=</span>epc<span class="op">().</span>win<span class="op">();</span>Q<span class="op">.</span>push<span class="op">(</span>epc<span class="op">());</span></span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span><span class="op">(!</span>Q<span class="op">.</span>empty<span class="op">())</span></span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span>Q<span class="op">.</span>front<span class="op">();</span>Q<span class="op">.</span>pop<span class="op">();</span></span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span><span class="op">(</span>i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span><span class="dv">5</span><span class="op">;</span>i<span class="op">++)</span></span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a>            y<span class="op">=</span>x<span class="op">.</span>trans<span class="op">(</span>i<span class="op">);</span></span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span><span class="op">(</span>id<span class="op">.</span>find<span class="op">(</span>y<span class="op">)==</span>id<span class="op">.</span>end<span class="op">())</span></span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a>                id<span class="op">[</span>y<span class="op">]=++</span>tot<span class="op">,</span>book<span class="op">[</span>tot<span class="op">]=</span>y<span class="op">.</span>win<span class="op">(),</span>Q<span class="op">.</span>push<span class="op">(</span>y<span class="op">);</span></span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a>            trans<span class="op">[</span>id<span class="op">[</span>x<span class="op">]][</span>i<span class="op">]=</span>id<span class="op">[</span>y<span class="op">];</span></span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span><span class="op">;</span></span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a><span class="at">const</span> <span class="dt">int</span> N<span class="op">=</span><span class="dv">105</span><span class="op">;</span></span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> n<span class="op">,</span>tans<span class="op">;</span></span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> cnt<span class="op">[</span>N<span class="op">];</span></span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> dp<span class="op">[</span><span class="dv">2</span><span class="op">][</span>M<span class="op">][</span>N<span class="op">*</span><span class="dv">4</span><span class="op">];</span></span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> fact<span class="op">[</span>N<span class="op">*</span><span class="dv">4</span><span class="op">],</span>ifact<span class="op">[</span>N<span class="op">*</span><span class="dv">4</span><span class="op">];</span></span>
<span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> ans<span class="op">[</span>N<span class="op">*</span><span class="dv">4</span><span class="op">];</span></span>
<span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a><span class="kw">inline</span> <span class="dt">int</span> choose<span class="op">(</span><span class="dt">int</span> n<span class="op">,</span><span class="dt">int</span> m<span class="op">)</span></span>
<span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> mul<span class="op">(</span>fact<span class="op">[</span>n<span class="op">],</span>mul<span class="op">(</span>ifact<span class="op">[</span>m<span class="op">],</span>ifact<span class="op">[</span>n<span class="op">-</span>m<span class="op">]));</span></span>
<span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1-135"><a href="#cb1-135" aria-hidden="true" tabindex="-1"></a><span class="dt">signed</span> main<span class="op">()</span></span>
<span id="cb1-136"><a href="#cb1-136" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb1-137"><a href="#cb1-137" aria-hidden="true" tabindex="-1"></a>    bfs<span class="op">();</span></span>
<span id="cb1-138"><a href="#cb1-138" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> x<span class="op">;</span></span>
<span id="cb1-139"><a href="#cb1-139" aria-hidden="true" tabindex="-1"></a>    <span class="at">register</span> <span class="dt">int</span> i<span class="op">,</span>j<span class="op">,</span>k<span class="op">,</span>c<span class="op">;</span></span>
<span id="cb1-140"><a href="#cb1-140" aria-hidden="true" tabindex="-1"></a>    scanf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%d</span><span class="st">&quot;</span><span class="op">,&amp;</span>n<span class="op">);</span></span>
<span id="cb1-141"><a href="#cb1-141" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(</span>i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span><span class="dv">13</span><span class="op">;</span>i<span class="op">++)</span></span>
<span id="cb1-142"><a href="#cb1-142" aria-hidden="true" tabindex="-1"></a>        scanf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%d%*d</span><span class="st">&quot;</span><span class="op">,&amp;</span>x<span class="op">),</span>cnt<span class="op">[</span>x<span class="op">]++;</span></span>
<span id="cb1-143"><a href="#cb1-143" aria-hidden="true" tabindex="-1"></a>    fact<span class="op">[</span><span class="dv">0</span><span class="op">]=</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb1-144"><a href="#cb1-144" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(</span>i<span class="op">=</span><span class="dv">1</span><span class="op">;</span>i<span class="op">&lt;=</span><span class="dv">4</span><span class="op">*</span>n<span class="op">;</span>i<span class="op">++)</span></span>
<span id="cb1-145"><a href="#cb1-145" aria-hidden="true" tabindex="-1"></a>        fact<span class="op">[</span>i<span class="op">]=</span>mul<span class="op">(</span>fact<span class="op">[</span>i<span class="op">-</span><span class="dv">1</span><span class="op">],</span>i<span class="op">);</span></span>
<span id="cb1-146"><a href="#cb1-146" aria-hidden="true" tabindex="-1"></a>    ifact<span class="op">[</span><span class="dv">4</span><span class="op">*</span>n<span class="op">]=</span>qpow<span class="op">(</span>fact<span class="op">[</span><span class="dv">4</span><span class="op">*</span>n<span class="op">],</span>mod<span class="op">-</span><span class="dv">2</span><span class="op">);</span></span>
<span id="cb1-147"><a href="#cb1-147" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(</span>i<span class="op">=</span><span class="dv">4</span><span class="op">*</span>n<span class="op">-</span><span class="dv">1</span><span class="op">;</span>i<span class="op">&gt;=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">--)</span></span>
<span id="cb1-148"><a href="#cb1-148" aria-hidden="true" tabindex="-1"></a>        ifact<span class="op">[</span>i<span class="op">]=</span>mul<span class="op">(</span>ifact<span class="op">[</span>i<span class="op">+</span><span class="dv">1</span><span class="op">],</span>i<span class="op">+</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb1-149"><a href="#cb1-149" aria-hidden="true" tabindex="-1"></a>    dp<span class="op">[</span><span class="dv">0</span><span class="op">][</span><span class="dv">1</span><span class="op">][</span><span class="dv">0</span><span class="op">]=</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb1-150"><a href="#cb1-150" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(</span>i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span>n<span class="op">;</span>i<span class="op">++)</span></span>
<span id="cb1-151"><a href="#cb1-151" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb1-152"><a href="#cb1-152" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span><span class="op">(</span>j<span class="op">=</span><span class="dv">1</span><span class="op">;</span>j<span class="op">&lt;=</span>tot<span class="op">;</span>j<span class="op">++)</span></span>
<span id="cb1-153"><a href="#cb1-153" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span><span class="op">(</span>k<span class="op">=</span><span class="dv">0</span><span class="op">;</span>k<span class="op">&lt;=</span><span class="dv">4</span><span class="op">*(</span>i<span class="op">+</span><span class="dv">1</span><span class="op">);</span>k<span class="op">++)</span></span>
<span id="cb1-154"><a href="#cb1-154" aria-hidden="true" tabindex="-1"></a>                dp<span class="op">[(</span>i<span class="op">+</span><span class="dv">1</span><span class="op">)&amp;</span><span class="dv">1</span><span class="op">][</span>j<span class="op">][</span>k<span class="op">]=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-155"><a href="#cb1-155" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span><span class="op">(</span>j<span class="op">=</span><span class="dv">1</span><span class="op">;</span>j<span class="op">&lt;=</span>tot<span class="op">;</span>j<span class="op">++)</span></span>
<span id="cb1-156"><a href="#cb1-156" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span><span class="op">(</span>k<span class="op">=</span><span class="dv">0</span><span class="op">;</span>k<span class="op">&lt;=</span><span class="dv">4</span><span class="op">*</span>i<span class="op">;</span>k<span class="op">++)</span></span>
<span id="cb1-157"><a href="#cb1-157" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span><span class="op">(</span>dp<span class="op">[</span>i<span class="op">&amp;</span><span class="dv">1</span><span class="op">][</span>j<span class="op">][</span>k<span class="op">])</span></span>
<span id="cb1-158"><a href="#cb1-158" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span><span class="op">(</span>c<span class="op">=</span><span class="dv">0</span><span class="op">;</span>c<span class="op">&lt;=</span><span class="dv">4</span><span class="op">-</span>cnt<span class="op">[</span>i<span class="op">+</span><span class="dv">1</span><span class="op">];</span>c<span class="op">++)</span></span>
<span id="cb1-159"><a href="#cb1-159" aria-hidden="true" tabindex="-1"></a>                        dp<span class="op">[(</span>i<span class="op">+</span><span class="dv">1</span><span class="op">)&amp;</span><span class="dv">1</span><span class="op">][</span>trans<span class="op">[</span>j<span class="op">][</span>cnt<span class="op">[</span>i<span class="op">+</span><span class="dv">1</span><span class="op">]+</span>c<span class="op">]][</span>k<span class="op">+</span>c<span class="op">]=</span>add<span class="op">(</span>dp<span class="op">[(</span>i<span class="op">+</span><span class="dv">1</span><span class="op">)&amp;</span><span class="dv">1</span><span class="op">][</span>trans<span class="op">[</span>j<span class="op">][</span>cnt<span class="op">[</span>i<span class="op">+</span><span class="dv">1</span><span class="op">]+</span>c<span class="op">]][</span>k<span class="op">+</span>c<span class="op">],</span>mul<span class="op">(</span>dp<span class="op">[</span>i<span class="op">&amp;</span><span class="dv">1</span><span class="op">][</span>j<span class="op">][</span>k<span class="op">],</span>mul<span class="op">(</span>mul<span class="op">(</span>choose<span class="op">(</span><span class="dv">4</span><span class="op">-</span>cnt<span class="op">[</span>i<span class="op">+</span><span class="dv">1</span><span class="op">],</span>c<span class="op">),</span>fact<span class="op">[</span>c<span class="op">]),</span>choose<span class="op">(</span>k<span class="op">+</span>c<span class="op">,</span>c<span class="op">))));</span></span>
<span id="cb1-160"><a href="#cb1-160" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-161"><a href="#cb1-161" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(</span>j<span class="op">=</span><span class="dv">1</span><span class="op">;</span>j<span class="op">&lt;=</span>tot<span class="op">;</span>j<span class="op">++)</span></span>
<span id="cb1-162"><a href="#cb1-162" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span><span class="op">(!</span>book<span class="op">[</span>j<span class="op">])</span></span>
<span id="cb1-163"><a href="#cb1-163" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span><span class="op">(</span>k<span class="op">=</span><span class="dv">0</span><span class="op">;</span>k<span class="op">&lt;=</span><span class="dv">4</span><span class="op">*</span>n<span class="op">-</span><span class="dv">13</span><span class="op">;</span>k<span class="op">++)</span></span>
<span id="cb1-164"><a href="#cb1-164" aria-hidden="true" tabindex="-1"></a>                ans<span class="op">[</span>k<span class="op">]=</span>add<span class="op">(</span>ans<span class="op">[</span>k<span class="op">],</span>dp<span class="op">[</span>n<span class="op">&amp;</span><span class="dv">1</span><span class="op">][</span>j<span class="op">][</span>k<span class="op">]);</span></span>
<span id="cb1-165"><a href="#cb1-165" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(</span>k<span class="op">=</span><span class="dv">0</span><span class="op">;</span>k<span class="op">&lt;=</span><span class="dv">4</span><span class="op">*</span>n<span class="op">-</span><span class="dv">13</span><span class="op">;</span>k<span class="op">++)</span></span>
<span id="cb1-166"><a href="#cb1-166" aria-hidden="true" tabindex="-1"></a>        ans<span class="op">[</span>k<span class="op">]=</span>mul<span class="op">(</span>ans<span class="op">[</span>k<span class="op">],</span>qpow<span class="op">(</span>mul<span class="op">(</span>choose<span class="op">(</span><span class="dv">4</span><span class="op">*</span>n<span class="op">-</span><span class="dv">13</span><span class="op">,</span>k<span class="op">),</span>fact<span class="op">[</span>k<span class="op">]),</span>mod<span class="op">-</span><span class="dv">2</span><span class="op">));</span></span>
<span id="cb1-167"><a href="#cb1-167" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(</span>k<span class="op">=</span><span class="dv">0</span><span class="op">;</span>k<span class="op">&lt;=</span><span class="dv">4</span><span class="op">*</span>n<span class="op">-</span><span class="dv">13</span><span class="op">;</span>k<span class="op">++)</span></span>
<span id="cb1-168"><a href="#cb1-168" aria-hidden="true" tabindex="-1"></a>        tans<span class="op">=</span>add<span class="op">(</span>tans<span class="op">,</span>ans<span class="op">[</span>k<span class="op">]);</span></span>
<span id="cb1-169"><a href="#cb1-169" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%d\n</span><span class="st">&quot;</span><span class="op">,</span>tans<span class="op">);</span></span>
<span id="cb1-170"><a href="#cb1-170" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-171"><a href="#cb1-171" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="线段树">线段树</h3>
<h6 id="题意-1">题意</h6>
<p>你有一棵按照常规方法建立的<span
class="math inline">[1,n]</span>的线段树，每个节点上有一个<span
class="math inline">0/1</span>变量<span
class="math inline">tag</span>。每次可以对区间<span
class="math inline">[l,r]</span>进行修改，修改的方法为：设定位到的节点集合为<span
class="math inline">S</span>，则将<span
class="math inline">S</span>的所有祖先的<span
class="math inline">tag</span>按深度顺序下传。下传规则为：如果<span
class="math inline">tag</span>为<span
class="math inline">1</span>，则将儿子的<span
class="math inline">tag</span>设为<span
class="math inline">1</span>，并将自己的<span
class="math inline">tag</span>设为<span
class="math inline">0</span>。最后将所有<span
class="math inline">S</span>中点的<span
class="math inline">tag</span>设为<span
class="math inline">1</span>。现在<span
class="math inline">m</span>个操作，分为两种：</p>
<p><span
class="math inline">1</span>、将当前的每棵线段树复制一份，并对所有复制品执行对给定区间<span
class="math inline">[l,r]</span>的修改。</p>
<p><span class="math inline">2</span>、询问所有线段树<span
class="math inline">tag</span>为<span
class="math inline">1</span>的节点数目。</p>
<p><span class="math inline">n,m\leq 10^5</span>。答案对<span
class="math inline">998244353</span>取模。</p>
<h5 id="题解-1">题解</h5>
<p>不妨将操作一看作是每次有<span
class="math inline">\frac{1}{2}</span>的概率对这棵线段树进行操作。这对我们接下来的考虑会方便一些。</p>
<p>于是我们对于线段树的每个节点，维护两个值<span
class="math inline">p</span>，<span
class="math inline">q</span>，表示这个节点<span
class="math inline">tag</span>为<span
class="math inline">1</span>的概率以及这个点到根的路径上有至少一个点<span
class="math inline">tag</span>为<span
class="math inline">1</span>的概率。那么我们只需要维护变量<span
class="math inline">sum</span>表示所有节点的<span
class="math inline">p</span>的和即可。假设已经做了<span
class="math inline">cnt</span>次<span
class="math inline">1</span>操作，那么询问的答案就是<span
class="math inline">sum*2^{cnt}</span>。</p>
<p>考虑每一次修改对每个节点的影响。我们可以将节点分为<span
class="math inline">5</span>类：</p>
<p><span class="math inline">1</span>、是<span
class="math inline">S</span>的祖先。</p>
<p><span class="math inline">2</span>、是<span
class="math inline">S</span>中的节点。</p>
<p><span class="math inline">3、</span>不是<span
class="math inline">S</span>中的节点，但它的父亲是<span
class="math inline">S</span>的祖先。</p>
<p><span class="math inline">4</span>、<span
class="math inline">2</span>类点的后代。</p>
<p><span class="math inline">5</span>、<span
class="math inline">3</span>类点的后代。</p>
<p>我们分别考虑影响：</p>
<p><span
class="math inline">1</span>、比较显然，由于标记一定都被下传了，因此<span
class="math inline">p\to \frac{p}{2}</span>，<span
class="math inline">q\to\frac{q}{2}</span>即可。</p>
<p><span
class="math inline">2</span>、也比较简单，由于一定被打了标记，因此<span
class="math inline">p\to\frac{p+1}{2}</span>，<span
class="math inline">q\to\frac{q+1}{2}</span>即可。</p>
<p><span
class="math inline">3</span>、考虑在操作后，这类点会有标记当且仅当其祖先或者自己有标记。操作后这个点以及它的祖先至少有一个有标记的概率是不变的，因此<span
class="math inline">p\to\frac{p+q}{2}</span>，<span
class="math inline">q\to q</span>。</p>
<p><span class="math inline">4</span>、这个操作对于<span
class="math inline">p</span>是没有影响的，但是由于它的祖先一定被打了标记，因此<span
class="math inline">p\to p</span>，<span class="math inline">q\to
\frac{q+1}{2}</span>。</p>
<p><span class="math inline">5</span>、嗯，似乎没有任何影响呢。<span
class="math inline">p\to p</span>，<span class="math inline">q\to
q</span>。</p>
<p>可以发现，前<span class="math inline">3</span>类点的数目都不超过<span
class="math inline">O(\log
n)</span>个，因此可以暴力修改，记得需要维护<span
class="math inline">sum</span>。唯一比较麻烦的是<span
class="math inline">4</span>类点。但由于修改比较单一，可以用懒标记实现。只需对每个点维护懒标记<span
class="math inline">k</span>、<span
class="math inline">b</span>，表示其所有后代的<span
class="math inline">q</span>实际上都为<span
class="math inline">kq+b</span>即可。并且这类操作对<span
class="math inline">sum</span>的值也没有影响。</p>
<p>于是直接实现这些操作就可以了。复杂度<span class="math inline">O(n\log
n)</span>。</p>
<p>代码：</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co">There is no end though there is a start in space. ---Infinity.</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">It has own power, it ruins, and it goes though there is a start also in the star. ---Finite.</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">Only the person who was wisdom can read the most foolish one from the history.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">The fish that lives in the sea doesn&#39;t know the world in the land. </span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">It also ruins and goes if they have wisdom.</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co">It is funnier that man exceeds the speed of light than fish start living in the land.</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">It can be said that this is an final ultimatum from the god to the people who can fight.</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span> </span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="pp">#include</span><span class="im">&lt;cstdio&gt;</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="at">const</span> <span class="dt">int</span> mod<span class="op">=</span><span class="dv">998244353</span><span class="op">,</span>inv2<span class="op">=(</span>mod<span class="op">+</span><span class="dv">1</span><span class="op">)/</span><span class="dv">2</span><span class="op">;</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="kw">inline</span> <span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span><span class="dt">int</span> b<span class="op">)</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">(</span>a<span class="op">+=</span>b<span class="op">)&gt;=</span>mod<span class="op">?</span>a<span class="op">-</span>mod<span class="op">:</span>a<span class="op">;</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="kw">inline</span> <span class="dt">int</span> sub<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span><span class="dt">int</span> b<span class="op">)</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">(</span>a<span class="op">-=</span>b<span class="op">)&lt;</span><span class="dv">0</span><span class="op">?</span>a<span class="op">+</span>mod<span class="op">:</span>a<span class="op">;</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="kw">inline</span> <span class="dt">int</span> mul<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span><span class="dt">int</span> b<span class="op">)</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">(</span><span class="dt">long</span> <span class="dt">long</span><span class="op">)</span>a<span class="op">*</span>b<span class="op">%</span>mod<span class="op">;</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="at">const</span> <span class="dt">int</span> N<span class="op">=</span><span class="fl">1e5</span><span class="op">+</span><span class="dv">5</span><span class="op">;</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> sum<span class="op">;</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> p<span class="op">[</span>N<span class="op">&lt;&lt;</span><span class="dv">2</span><span class="op">],</span>q<span class="op">[</span>N<span class="op">&lt;&lt;</span><span class="dv">2</span><span class="op">],</span>k<span class="op">[</span>N<span class="op">&lt;&lt;</span><span class="dv">2</span><span class="op">],</span>b<span class="op">[</span>N<span class="op">&lt;&lt;</span><span class="dv">2</span><span class="op">];</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="kw">inline</span> <span class="dt">void</span> push_down<span class="op">(</span><span class="dt">int</span> x<span class="op">)</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>    q<span class="op">[</span>x<span class="op">&lt;&lt;</span><span class="dv">1</span><span class="op">]=</span>add<span class="op">(</span>mul<span class="op">(</span>k<span class="op">[</span>x<span class="op">],</span>q<span class="op">[</span>x<span class="op">&lt;&lt;</span><span class="dv">1</span><span class="op">]),</span>b<span class="op">[</span>x<span class="op">]);</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>    b<span class="op">[</span>x<span class="op">&lt;&lt;</span><span class="dv">1</span><span class="op">]=</span>add<span class="op">(</span>mul<span class="op">(</span>k<span class="op">[</span>x<span class="op">],</span>b<span class="op">[</span>x<span class="op">&lt;&lt;</span><span class="dv">1</span><span class="op">]),</span>b<span class="op">[</span>x<span class="op">]);</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>    k<span class="op">[</span>x<span class="op">&lt;&lt;</span><span class="dv">1</span><span class="op">]=</span>mul<span class="op">(</span>k<span class="op">[</span>x<span class="op">],</span>k<span class="op">[</span>x<span class="op">&lt;&lt;</span><span class="dv">1</span><span class="op">]);</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>    q<span class="op">[</span>x<span class="op">&lt;&lt;</span><span class="dv">1</span><span class="op">|</span><span class="dv">1</span><span class="op">]=</span>add<span class="op">(</span>mul<span class="op">(</span>k<span class="op">[</span>x<span class="op">],</span>q<span class="op">[</span>x<span class="op">&lt;&lt;</span><span class="dv">1</span><span class="op">|</span><span class="dv">1</span><span class="op">]),</span>b<span class="op">[</span>x<span class="op">]);</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>    b<span class="op">[</span>x<span class="op">&lt;&lt;</span><span class="dv">1</span><span class="op">|</span><span class="dv">1</span><span class="op">]=</span>add<span class="op">(</span>mul<span class="op">(</span>k<span class="op">[</span>x<span class="op">],</span>b<span class="op">[</span>x<span class="op">&lt;&lt;</span><span class="dv">1</span><span class="op">|</span><span class="dv">1</span><span class="op">]),</span>b<span class="op">[</span>x<span class="op">]);</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>    k<span class="op">[</span>x<span class="op">&lt;&lt;</span><span class="dv">1</span><span class="op">|</span><span class="dv">1</span><span class="op">]=</span>mul<span class="op">(</span>k<span class="op">[</span>x<span class="op">],</span>k<span class="op">[</span>x<span class="op">&lt;&lt;</span><span class="dv">1</span><span class="op">|</span><span class="dv">1</span><span class="op">]);</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>    k<span class="op">[</span>x<span class="op">]=</span><span class="dv">1</span><span class="op">;</span>b<span class="op">[</span>x<span class="op">]=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span><span class="op">;</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> modify<span class="op">(</span><span class="dt">int</span> x<span class="op">,</span><span class="dt">int</span> lp<span class="op">,</span><span class="dt">int</span> rp<span class="op">,</span><span class="dt">int</span> l<span class="op">,</span><span class="dt">int</span> r<span class="op">)</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span><span class="op">(</span>lp<span class="op">==</span>l<span class="op">&amp;&amp;</span>rp<span class="op">==</span>r<span class="op">)</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>        sum<span class="op">=</span>sub<span class="op">(</span>sum<span class="op">,</span>p<span class="op">[</span>x<span class="op">]);</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>        p<span class="op">[</span>x<span class="op">]=</span>add<span class="op">(</span>mul<span class="op">(</span>inv2<span class="op">,</span>p<span class="op">[</span>x<span class="op">]),</span>inv2<span class="op">);</span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>        q<span class="op">[</span>x<span class="op">]=</span>add<span class="op">(</span>mul<span class="op">(</span>inv2<span class="op">,</span>q<span class="op">[</span>x<span class="op">]),</span>inv2<span class="op">);</span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>        b<span class="op">[</span>x<span class="op">]=</span>add<span class="op">(</span>mul<span class="op">(</span>inv2<span class="op">,</span>b<span class="op">[</span>x<span class="op">]),</span>inv2<span class="op">);</span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>        k<span class="op">[</span>x<span class="op">]=</span>mul<span class="op">(</span>inv2<span class="op">,</span>k<span class="op">[</span>x<span class="op">]);</span></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>        sum<span class="op">=</span>add<span class="op">(</span>sum<span class="op">,</span>p<span class="op">[</span>x<span class="op">]);</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span><span class="op">;</span></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>    push_down<span class="op">(</span>x<span class="op">);</span></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> mid<span class="op">=(</span>lp<span class="op">+</span>rp<span class="op">)&gt;&gt;</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>    sum<span class="op">=</span>sub<span class="op">(</span>sum<span class="op">,</span>p<span class="op">[</span>x<span class="op">]);</span></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>    p<span class="op">[</span>x<span class="op">]=</span>mul<span class="op">(</span>inv2<span class="op">,</span>p<span class="op">[</span>x<span class="op">]);</span></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>    q<span class="op">[</span>x<span class="op">]=</span>mul<span class="op">(</span>inv2<span class="op">,</span>q<span class="op">[</span>x<span class="op">]);</span></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>    sum<span class="op">=</span>add<span class="op">(</span>sum<span class="op">,</span>p<span class="op">[</span>x<span class="op">]);</span></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span><span class="op">(</span>r<span class="op">&lt;=</span>mid<span class="op">)</span></span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>        modify<span class="op">(</span>x<span class="op">&lt;&lt;</span><span class="dv">1</span><span class="op">,</span>lp<span class="op">,</span>mid<span class="op">,</span>l<span class="op">,</span>r<span class="op">);</span></span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>        sum<span class="op">=</span>sub<span class="op">(</span>sum<span class="op">,</span>p<span class="op">[</span>x<span class="op">&lt;&lt;</span><span class="dv">1</span><span class="op">|</span><span class="dv">1</span><span class="op">]);</span></span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>        p<span class="op">[</span>x<span class="op">&lt;&lt;</span><span class="dv">1</span><span class="op">|</span><span class="dv">1</span><span class="op">]=</span>mul<span class="op">(</span>inv2<span class="op">,</span>add<span class="op">(</span>p<span class="op">[</span>x<span class="op">&lt;&lt;</span><span class="dv">1</span><span class="op">|</span><span class="dv">1</span><span class="op">],</span>q<span class="op">[</span>x<span class="op">&lt;&lt;</span><span class="dv">1</span><span class="op">|</span><span class="dv">1</span><span class="op">]));</span></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>        sum<span class="op">=</span>add<span class="op">(</span>sum<span class="op">,</span>p<span class="op">[</span>x<span class="op">&lt;&lt;</span><span class="dv">1</span><span class="op">|</span><span class="dv">1</span><span class="op">]);</span></span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span><span class="op">(</span>l<span class="op">&gt;=</span>mid<span class="op">+</span><span class="dv">1</span><span class="op">)</span></span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>        sum<span class="op">=</span>sub<span class="op">(</span>sum<span class="op">,</span>p<span class="op">[</span>x<span class="op">&lt;&lt;</span><span class="dv">1</span><span class="op">]);</span></span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>        p<span class="op">[</span>x<span class="op">&lt;&lt;</span><span class="dv">1</span><span class="op">]=</span>mul<span class="op">(</span>inv2<span class="op">,</span>add<span class="op">(</span>p<span class="op">[</span>x<span class="op">&lt;&lt;</span><span class="dv">1</span><span class="op">],</span>q<span class="op">[</span>x<span class="op">&lt;&lt;</span><span class="dv">1</span><span class="op">]));</span></span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>        sum<span class="op">=</span>add<span class="op">(</span>sum<span class="op">,</span>p<span class="op">[</span>x<span class="op">&lt;&lt;</span><span class="dv">1</span><span class="op">]);</span></span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>        modify<span class="op">(</span>x<span class="op">&lt;&lt;</span><span class="dv">1</span><span class="op">|</span><span class="dv">1</span><span class="op">,</span>mid<span class="op">+</span><span class="dv">1</span><span class="op">,</span>rp<span class="op">,</span>l<span class="op">,</span>r<span class="op">);</span></span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>        modify<span class="op">(</span>x<span class="op">&lt;&lt;</span><span class="dv">1</span><span class="op">,</span>lp<span class="op">,</span>mid<span class="op">,</span>l<span class="op">,</span>mid<span class="op">),</span>modify<span class="op">(</span>x<span class="op">&lt;&lt;</span><span class="dv">1</span><span class="op">|</span><span class="dv">1</span><span class="op">,</span>mid<span class="op">+</span><span class="dv">1</span><span class="op">,</span>rp<span class="op">,</span>mid<span class="op">+</span><span class="dv">1</span><span class="op">,</span>r<span class="op">);</span></span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span><span class="op">;</span></span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> build<span class="op">(</span><span class="dt">int</span> x<span class="op">,</span><span class="dt">int</span> lp<span class="op">,</span><span class="dt">int</span> rp<span class="op">)</span></span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a>    k<span class="op">[</span>x<span class="op">]=</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span><span class="op">(</span>lp<span class="op">==</span>rp<span class="op">)</span></span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span><span class="op">;</span></span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> mid<span class="op">=(</span>lp<span class="op">+</span>rp<span class="op">)&gt;&gt;</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>    build<span class="op">(</span>x<span class="op">&lt;&lt;</span><span class="dv">1</span><span class="op">,</span>lp<span class="op">,</span>mid<span class="op">);</span></span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a>    build<span class="op">(</span>x<span class="op">&lt;&lt;</span><span class="dv">1</span><span class="op">|</span><span class="dv">1</span><span class="op">,</span>mid<span class="op">+</span><span class="dv">1</span><span class="op">,</span>rp<span class="op">);</span></span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span><span class="op">;</span></span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> n<span class="op">,</span>m<span class="op">;</span></span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a><span class="dt">signed</span> main<span class="op">()</span></span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> opt<span class="op">,</span>l<span class="op">,</span>r<span class="op">,</span>w<span class="op">=</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a>    scanf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%d%d</span><span class="st">&quot;</span><span class="op">,&amp;</span>n<span class="op">,&amp;</span>m<span class="op">);</span></span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a>    build<span class="op">(</span><span class="dv">1</span><span class="op">,</span><span class="dv">1</span><span class="op">,</span>n<span class="op">);</span></span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span><span class="op">(</span>m<span class="op">--)</span></span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span><span class="op">(</span>scanf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%d</span><span class="st">&quot;</span><span class="op">,&amp;</span>opt<span class="op">),</span>opt<span class="op">==</span><span class="dv">1</span><span class="op">)</span></span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a>            scanf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%d%d</span><span class="st">&quot;</span><span class="op">,&amp;</span>l<span class="op">,&amp;</span>r<span class="op">),</span>modify<span class="op">(</span><span class="dv">1</span><span class="op">,</span><span class="dv">1</span><span class="op">,</span>n<span class="op">,</span>l<span class="op">,</span>r<span class="op">),</span>w<span class="op">=</span>mul<span class="op">(</span>w<span class="op">,</span><span class="dv">2</span><span class="op">);</span></span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a>            printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%d\n</span><span class="st">&quot;</span><span class="op">,</span>mul<span class="op">(</span>w<span class="op">,</span>sum<span class="op">));</span></span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="minimax搜索">Minimax搜索</h3>
<h5 id="题意-2">题意</h5>
<p>有一颗<span class="math inline">n</span>个点的数，标号为<span
class="math inline">1\sim n</span>，根节点为<span
class="math inline">1</span>，深度为<span
class="math inline">1</span>。每个点有一个权值。叶子的权值是它的标号，否则，假如其深度为奇数，那么其权值为所有儿子权值的<span
class="math inline">\max</span>，否则为所有儿子权值的<span
class="math inline">\min</span>。一个叶子节点的集合的权值定义为：对于一个<span
class="math inline">w</span>，<span
class="math inline">f_w</span>表示这个集合内的节点的权值可以修改为任意和原来权值的差的绝对值不超过<span
class="math inline">w</span>的整数，是否可以改变根节点的权值。那么这个叶子节点集合的权值为最小的使得<span
class="math inline">f_w=1</span>的<span
class="math inline">w</span>。特别的，假如不存在这样的<span
class="math inline">w</span>，那么这个集合的权值为<span
class="math inline">n</span>。现在给定<span
class="math inline">L</span>，<span
class="math inline">R</span>，问对于所有整数<span
class="math inline">i\in[L,R]</span>，权值为<span
class="math inline">i</span>的非空叶子集合的数目。</p>
<p><span class="math inline">n\leq 2*10^5,0\leq L\leq R\leq
n</span>。答案对<span class="math inline">998244353</span>取模。</p>
<h5 id="题解-2">题解</h5>
<p>我们首先考虑如何计算对于<span
class="math inline">i=0,1,2,\dots,n</span>，权值<span
class="math inline">\leq
i</span>的集合数目。最后通过差分我们就得到了答案。</p>
<p>那么首先考虑如何对于一个特定的<span
class="math inline">w</span>，计算权值<span class="math inline">\leq
w</span>的集合数目。</p>
<p>首先我们可以通过一遍<span
class="math inline">dfs</span>将根节点的权值计算出来，假设其为<span
class="math inline">W</span>。由于叶子节点的权值互不相同，因此权值和根相同的叶子是唯一的。不难发现如果我们修改了这个叶子，根节点的答案一定会变化。因此只要<span
class="math inline">w&gt;0</span>，那么所有包含这个叶子的集合的权值都是<span
class="math inline">\leq
w</span>的，可以直接计入贡献。现在我们只需要考虑不包含这个叶子的集合。</p>
<p>我们可以发现，想要修改根的权值，有让它变大和让它变小两种选择。对于让它变大的情况，与其让它变得非常大，不如让它变成<span
class="math inline">W+1</span>，因为这一定不会比变得非常大更困难。于是我们可以发现，修改所有权值<span
class="math inline">&gt;W</span>的叶子都是没有作用的，我们只要知道如果让这个集合中能够变成<span
class="math inline">W+1</span>的权值<span
class="math inline">&lt;W</span>的叶子都变成<span
class="math inline">W+1</span>以后，判断一下根节点是否为<span
class="math inline">W+1</span>，就可以知道这个集合的权值是否<span
class="math inline">\leq
w</span>。对于让根节点权值变小的情况也是同理的。那么可以发现，一个叶子集合的权值<span
class="math inline">\leq w</span>意味着可以用集合中<span
class="math inline">&lt;W</span>的叶子让根变成<span
class="math inline">W+1</span>或者可以用集合中<span
class="math inline">&gt;W</span>的叶子让根变成<span
class="math inline">W-1</span>。为了更方便的计算我们可以用总方案数减去两个要求都不满足的方案。那么我们只需要知道有多少个只包含<span
class="math inline">&lt;W</span>的叶子的集合是不合法的，以及有多少个只包含<span
class="math inline">&gt;W</span>的叶子的集合是不合法的，将两个答案相乘即可。而这个不合法的方案数又可以用总数减去合法的方案数得出来。</p>
<p>由于两者是相似的，因此我们以计算有多少个只包含<span
class="math inline">&lt;W</span>的叶子的集合是合法的为例。</p>
<p>为了在计算中更加方便，我们将方案数转化为概率，令每个<span
class="math inline">&lt;W</span>的叶节点有<span
class="math inline">\frac{1}{2}</span>的概率出现在集合中。那么只要让最终答案乘以<span
class="math inline">2^{&lt;W的叶节点数目}</span>即可。令<span
class="math inline">f_x</span>表示<span
class="math inline">x</span>的权值能够<span
class="math inline">&gt;W</span>的概率，考虑如何转移。</p>
<p>首先是<span class="math inline">x</span>是<span
class="math inline">&lt;W</span>的叶节点的情况，那么只要判断：如果<span
class="math inline">x+w&gt;W</span>，那么<span
class="math inline">f_x=\frac{1}{2}</span>，否则<span
class="math inline">f_x=0</span>。</p>
<p><span class="math inline">x</span>是<span
class="math inline">&gt;W</span>的叶节点，那么<span
class="math inline">f_x=1</span>。</p>
<p>假如这是一个深度为奇数的点，那么它的权值可以<span
class="math inline">&gt;W</span>的概率就是它有任意一个儿子的权值可以<span
class="math inline">&gt;W</span>的概率。容斥一下，可以用<span
class="math inline">1</span>，减去所有儿子都不可以<span
class="math inline">&gt;W</span>的概率。于是有：</p>
<p><span class="math display">
f_x=1-\Big(\prod_{y\in son_x}1-f_y\Big)
</span></p>
<p>否则，这是一个深度为偶数的点，那么它的权值可以<span
class="math inline">&gt;W</span>的概率就是它所有儿子的权值都可以<span
class="math inline">&gt;W</span>的概率。于是有：</p>
<p><span class="math display">
f_x=\prod_{y\in son_x}f_y
</span></p>
<p>我们发现两个转移的形式比较相似，于是考虑进一步进行简化。我们可以设<span
class="math inline">f&#39;_x</span>，当<span
class="math inline">x</span>的深度为奇数时，<span
class="math inline">f&#39;_x=1-f_x</span>，否则<span
class="math inline">f&#39;_x=f_x</span>。不难发现此时我们的转移式就都变成了：</p>
<p><span class="math display">
f&#39;_x=\prod_{y\in son_x}1-f&#39;_y
</span></p>
<p>变得更加简单。于是我们可以轻松的在<span
class="math inline">O(n)</span>的时间内求出对于某个特定的<span
class="math inline">w</span>的答案。</p>
<p>现在考虑快速求出所有的答案。我们发现只有当叶子节点的答案改变了，最终答案才会改变。而对于每一个叶子节点，在<span
class="math inline">w</span>增大的过程中只会发生最多一次改变。因此总的改变次数是<span
class="math inline">O(n)</span>级别的。于是我们考虑进行动态<span
class="math inline">dp</span>，由于<span
class="math inline">dp</span>过程非常简单因此可以比较容易的进行动态<span
class="math inline">dp</span>。用树链剖分来实现，复杂度就是<span
class="math inline">O(n\log^2 n)</span>。</p>
<p>代码：</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co">There is no end though there is a start in space. ---Infinity.</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">It has own power, it ruins, and it goes though there is a start also in the star. ---Finite.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">Only the person who was wisdom can read the most foolish one from the history.</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">The fish that lives in the sea doesn&#39;t know the world in the land.</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co">It also ruins and goes if they have wisdom.</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co">It is funnier that man exceeds the speed of light than fish start living in the land.</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co">It can be said that this is an final ultimatum from the god to the people who can fight.</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="pp">#include</span><span class="im">&lt;cstdio&gt;</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="pp">#include</span><span class="im">&lt;cstring&gt;</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="pp">#include</span><span class="im">&lt;algorithm&gt;</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="pp">#include</span><span class="im">&lt;functional&gt;</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="pp">#include</span><span class="im">&lt;vector&gt;</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="bu">std::</span>max<span class="op">;</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="bu">std::</span>min<span class="op">;</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="bu">std::</span>sort<span class="op">;</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="bu">std::</span>greater<span class="op">;</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="bu">std::</span>vector<span class="op">;</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="at">const</span> <span class="dt">int</span> mod<span class="op">=</span><span class="dv">998244353</span><span class="op">,</span>inv2<span class="op">=(</span>mod<span class="op">+</span><span class="dv">1</span><span class="op">)/</span><span class="dv">2</span><span class="op">;</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="kw">inline</span> <span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span><span class="dt">int</span> b<span class="op">)</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">(</span>a<span class="op">+=</span>b<span class="op">)&gt;=</span>mod<span class="op">?</span>a<span class="op">-</span>mod<span class="op">:</span>a<span class="op">;</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="kw">inline</span> <span class="dt">int</span> sub<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span><span class="dt">int</span> b<span class="op">)</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">(</span>a<span class="op">-=</span>b<span class="op">)&lt;</span><span class="dv">0</span><span class="op">?</span>a<span class="op">+</span>mod<span class="op">:</span>a<span class="op">;</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="kw">inline</span> <span class="dt">int</span> mul<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span><span class="dt">int</span> b<span class="op">)</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">(</span><span class="dt">long</span> <span class="dt">long</span><span class="op">)</span>a<span class="op">*</span>b<span class="op">%</span>mod<span class="op">;</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a><span class="kw">inline</span> <span class="dt">int</span> qpow<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span><span class="dt">int</span> b<span class="op">)</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> res<span class="op">=</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(;</span>b<span class="op">;</span>a<span class="op">=</span>mul<span class="op">(</span>a<span class="op">,</span>a<span class="op">),</span>b<span class="op">&gt;&gt;=</span><span class="dv">1</span><span class="op">)</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span><span class="op">(</span>b<span class="op">&amp;</span><span class="dv">1</span><span class="op">)</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>            res<span class="op">=</span>mul<span class="op">(</span>res<span class="op">,</span>a<span class="op">);</span></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> res<span class="op">;</span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a><span class="at">const</span> <span class="dt">int</span> N<span class="op">=</span><span class="fl">2e5</span><span class="op">+</span><span class="dv">5</span><span class="op">;</span></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> zint</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> v<span class="op">,</span>cnt<span class="op">;</span></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>    zint<span class="op">(</span><span class="dt">int</span> x<span class="op">=</span><span class="dv">0</span><span class="op">)</span></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span><span class="op">(</span>x<span class="op">)</span></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>            v<span class="op">=</span>x<span class="op">,</span>cnt<span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>            v<span class="op">=</span><span class="dv">1</span><span class="op">,</span>cnt<span class="op">=</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span><span class="op">;</span></span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>    zint<span class="op">(</span><span class="dt">int</span> _v<span class="op">,</span><span class="dt">int</span> _cnt<span class="op">)</span></span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>        v<span class="op">=</span>_v<span class="op">;</span>cnt<span class="op">=</span>_cnt<span class="op">;</span></span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span><span class="op">;</span></span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>    <span class="kw">inline</span> <span class="dt">int</span> to_int<span class="op">()</span></span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span><span class="op">(</span>cnt<span class="op">)</span></span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> v<span class="op">;</span></span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>    <span class="kw">inline</span> zint <span class="kw">operator</span><span class="op">*(</span><span class="at">const</span> zint <span class="op">&amp;</span>th<span class="op">)</span></span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> zint<span class="op">(</span>mul<span class="op">(</span>v<span class="op">,</span>th<span class="op">.</span>v<span class="op">),</span>cnt<span class="op">+</span>th<span class="op">.</span>cnt<span class="op">);</span></span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>    <span class="kw">inline</span> zint <span class="kw">operator</span><span class="op">/(</span><span class="at">const</span> zint <span class="op">&amp;</span>th<span class="op">)</span></span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> zint<span class="op">(</span>mul<span class="op">(</span>v<span class="op">,</span>qpow<span class="op">(</span>th<span class="op">.</span>v<span class="op">,</span>mod<span class="op">-</span><span class="dv">2</span><span class="op">)),</span>cnt<span class="op">-</span>th<span class="op">.</span>cnt<span class="op">);</span></span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> epc</span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> k<span class="op">,</span>b<span class="op">;</span></span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a>    epc<span class="op">(</span><span class="dt">int</span> _k<span class="op">=</span><span class="dv">1</span><span class="op">,</span><span class="dt">int</span> _b<span class="op">=</span><span class="dv">0</span><span class="op">)</span></span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a>        k<span class="op">=</span>_k<span class="op">;</span>b<span class="op">=</span>_b<span class="op">;</span></span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span><span class="op">;</span></span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a>    <span class="kw">inline</span> epc <span class="kw">operator</span><span class="op">*(</span><span class="at">const</span> epc <span class="op">&amp;</span>th<span class="op">)</span></span>
<span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> epc<span class="op">{</span>mul<span class="op">(</span>th<span class="op">.</span>k<span class="op">,</span>k<span class="op">),</span>add<span class="op">(</span>mul<span class="op">(</span>th<span class="op">.</span>b<span class="op">,</span>k<span class="op">),</span>b<span class="op">)};</span></span>
<span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>I<span class="op">=</span>epc<span class="op">();</span></span>
<span id="cb3-86"><a href="#cb3-86" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> zkw</span>
<span id="cb3-87"><a href="#cb3-87" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb3-88"><a href="#cb3-88" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> M<span class="op">;</span></span>
<span id="cb3-89"><a href="#cb3-89" aria-hidden="true" tabindex="-1"></a>    epc sgt<span class="op">[</span>N<span class="op">&lt;&lt;</span><span class="dv">2</span><span class="op">];</span></span>
<span id="cb3-90"><a href="#cb3-90" aria-hidden="true" tabindex="-1"></a>    <span class="kw">inline</span> <span class="dt">void</span> init<span class="op">(</span><span class="dt">int</span> n<span class="op">)</span></span>
<span id="cb3-91"><a href="#cb3-91" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb3-92"><a href="#cb3-92" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span><span class="op">(</span>M<span class="op">=</span><span class="dv">1</span><span class="op">;</span>M<span class="op">&lt;=</span>n<span class="op">;</span>M<span class="op">&lt;&lt;=</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb3-93"><a href="#cb3-93" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span><span class="op">;</span></span>
<span id="cb3-94"><a href="#cb3-94" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb3-95"><a href="#cb3-95" aria-hidden="true" tabindex="-1"></a>    <span class="kw">inline</span> <span class="dt">void</span> modify<span class="op">(</span><span class="dt">int</span> x<span class="op">,</span>epc k<span class="op">)</span></span>
<span id="cb3-96"><a href="#cb3-96" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb3-97"><a href="#cb3-97" aria-hidden="true" tabindex="-1"></a>        sgt<span class="op">[</span>M<span class="op">+</span>x<span class="op">]=</span>k<span class="op">;</span></span>
<span id="cb3-98"><a href="#cb3-98" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span><span class="op">(</span>x<span class="op">=(</span>M<span class="op">+</span>x<span class="op">)&gt;&gt;</span><span class="dv">1</span><span class="op">;</span>x<span class="op">;</span>x<span class="op">&gt;&gt;=</span><span class="dv">1</span><span class="op">)</span></span>
<span id="cb3-99"><a href="#cb3-99" aria-hidden="true" tabindex="-1"></a>            sgt<span class="op">[</span>x<span class="op">]=</span>sgt<span class="op">[</span>x<span class="op">&lt;&lt;</span><span class="dv">1</span><span class="op">]*</span>sgt<span class="op">[</span>x<span class="op">&lt;&lt;</span><span class="dv">1</span><span class="op">|</span><span class="dv">1</span><span class="op">];</span></span>
<span id="cb3-100"><a href="#cb3-100" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span><span class="op">;</span></span>
<span id="cb3-101"><a href="#cb3-101" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb3-102"><a href="#cb3-102" aria-hidden="true" tabindex="-1"></a>    <span class="kw">inline</span> epc query<span class="op">(</span><span class="dt">int</span> l<span class="op">,</span><span class="dt">int</span> r<span class="op">)</span></span>
<span id="cb3-103"><a href="#cb3-103" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb3-104"><a href="#cb3-104" aria-hidden="true" tabindex="-1"></a>        epc lres<span class="op">=</span>I<span class="op">,</span>rres<span class="op">=</span>I<span class="op">;</span></span>
<span id="cb3-105"><a href="#cb3-105" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span><span class="op">(</span>l<span class="op">=</span>M<span class="op">+</span>l<span class="op">-</span><span class="dv">1</span><span class="op">,</span>r<span class="op">=</span>M<span class="op">+</span>r<span class="op">+</span><span class="dv">1</span><span class="op">;</span>l<span class="op">^</span>r<span class="op">^</span><span class="dv">1</span><span class="op">;</span>l<span class="op">&gt;&gt;=</span><span class="dv">1</span><span class="op">,</span>r<span class="op">&gt;&gt;=</span><span class="dv">1</span><span class="op">)</span></span>
<span id="cb3-106"><a href="#cb3-106" aria-hidden="true" tabindex="-1"></a>            lres<span class="op">=(</span>l<span class="op">&amp;</span><span class="dv">1</span><span class="op">)?</span>lres<span class="op">:</span>lres<span class="op">*</span>sgt<span class="op">[</span>l<span class="op">^</span><span class="dv">1</span><span class="op">],</span>rres<span class="op">=(</span>r<span class="op">&amp;</span><span class="dv">1</span><span class="op">)?</span>sgt<span class="op">[</span>r<span class="op">^</span><span class="dv">1</span><span class="op">]*</span>rres<span class="op">:</span>rres<span class="op">;</span></span>
<span id="cb3-107"><a href="#cb3-107" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> lres<span class="op">*</span>rres<span class="op">;</span></span>
<span id="cb3-108"><a href="#cb3-108" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb3-109"><a href="#cb3-109" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb3-110"><a href="#cb3-110" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> n<span class="op">,</span>L<span class="op">,</span>R<span class="op">,</span>idx<span class="op">;</span></span>
<span id="cb3-111"><a href="#cb3-111" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> isl<span class="op">[</span>N<span class="op">],</span>key<span class="op">[</span>N<span class="op">];</span></span>
<span id="cb3-112"><a href="#cb3-112" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> father<span class="op">[</span>N<span class="op">],</span>hson<span class="op">[</span>N<span class="op">],</span>size<span class="op">[</span>N<span class="op">],</span>deep<span class="op">[</span>N<span class="op">];</span></span>
<span id="cb3-113"><a href="#cb3-113" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> id<span class="op">[</span>N<span class="op">],</span>di<span class="op">[</span>N<span class="op">],</span>top<span class="op">[</span>N<span class="op">],</span>bot<span class="op">[</span>N<span class="op">];</span></span>
<span id="cb3-114"><a href="#cb3-114" aria-hidden="true" tabindex="-1"></a>zint dp<span class="op">[</span>N<span class="op">];</span></span>
<span id="cb3-115"><a href="#cb3-115" aria-hidden="true" tabindex="-1"></a>vector<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;</span> e<span class="op">[</span>N<span class="op">];</span></span>
<span id="cb3-116"><a href="#cb3-116" aria-hidden="true" tabindex="-1"></a>vector<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;</span> low<span class="op">,</span>ex<span class="op">,</span>high<span class="op">;</span></span>
<span id="cb3-117"><a href="#cb3-117" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> ansf<span class="op">[</span>N<span class="op">],</span>ansg<span class="op">[</span>N<span class="op">],</span>ans<span class="op">[</span>N<span class="op">];</span></span>
<span id="cb3-118"><a href="#cb3-118" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> dfs<span class="op">(</span><span class="dt">int</span> x<span class="op">,</span><span class="dt">int</span> father<span class="op">,</span><span class="dt">int</span> d<span class="op">)</span></span>
<span id="cb3-119"><a href="#cb3-119" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb3-120"><a href="#cb3-120" aria-hidden="true" tabindex="-1"></a>    isl<span class="op">[</span>x<span class="op">]=</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb3-121"><a href="#cb3-121" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span><span class="op">(</span>d<span class="op">&amp;</span><span class="dv">1</span><span class="op">)</span></span>
<span id="cb3-122"><a href="#cb3-122" aria-hidden="true" tabindex="-1"></a>        key<span class="op">[</span>x<span class="op">]=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-123"><a href="#cb3-123" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb3-124"><a href="#cb3-124" aria-hidden="true" tabindex="-1"></a>        key<span class="op">[</span>x<span class="op">]=</span>n<span class="op">+</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb3-125"><a href="#cb3-125" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(</span><span class="dt">int</span> y<span class="op">:</span>e<span class="op">[</span>x<span class="op">])</span></span>
<span id="cb3-126"><a href="#cb3-126" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span><span class="op">(</span>y<span class="op">!=</span>father<span class="op">)</span></span>
<span id="cb3-127"><a href="#cb3-127" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb3-128"><a href="#cb3-128" aria-hidden="true" tabindex="-1"></a>            isl<span class="op">[</span>x<span class="op">]=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-129"><a href="#cb3-129" aria-hidden="true" tabindex="-1"></a>            dfs<span class="op">(</span>y<span class="op">,</span>x<span class="op">,</span>d<span class="op">+</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb3-130"><a href="#cb3-130" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span><span class="op">(</span>d<span class="op">&amp;</span><span class="dv">1</span><span class="op">)</span></span>
<span id="cb3-131"><a href="#cb3-131" aria-hidden="true" tabindex="-1"></a>                key<span class="op">[</span>x<span class="op">]=</span>max<span class="op">(</span>key<span class="op">[</span>x<span class="op">],</span>key<span class="op">[</span>y<span class="op">]);</span></span>
<span id="cb3-132"><a href="#cb3-132" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span></span>
<span id="cb3-133"><a href="#cb3-133" aria-hidden="true" tabindex="-1"></a>                key<span class="op">[</span>x<span class="op">]=</span>min<span class="op">(</span>key<span class="op">[</span>x<span class="op">],</span>key<span class="op">[</span>y<span class="op">]);</span></span>
<span id="cb3-134"><a href="#cb3-134" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb3-135"><a href="#cb3-135" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span><span class="op">(</span>isl<span class="op">[</span>x<span class="op">])</span></span>
<span id="cb3-136"><a href="#cb3-136" aria-hidden="true" tabindex="-1"></a>        key<span class="op">[</span>x<span class="op">]=</span>x<span class="op">;</span></span>
<span id="cb3-137"><a href="#cb3-137" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span><span class="op">;</span></span>
<span id="cb3-138"><a href="#cb3-138" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb3-139"><a href="#cb3-139" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> dfs1<span class="op">(</span><span class="dt">int</span> x<span class="op">)</span></span>
<span id="cb3-140"><a href="#cb3-140" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb3-141"><a href="#cb3-141" aria-hidden="true" tabindex="-1"></a>    size<span class="op">[</span>x<span class="op">]=</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb3-142"><a href="#cb3-142" aria-hidden="true" tabindex="-1"></a>    deep<span class="op">[</span>x<span class="op">]=</span>deep<span class="op">[</span>father<span class="op">[</span>x<span class="op">]]+</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb3-143"><a href="#cb3-143" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(</span><span class="dt">int</span> y<span class="op">:</span>e<span class="op">[</span>x<span class="op">])</span></span>
<span id="cb3-144"><a href="#cb3-144" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span><span class="op">(</span>y<span class="op">!=</span>father<span class="op">[</span>x<span class="op">])</span></span>
<span id="cb3-145"><a href="#cb3-145" aria-hidden="true" tabindex="-1"></a>            father<span class="op">[</span>y<span class="op">]=</span>x<span class="op">,</span>dfs1<span class="op">(</span>y<span class="op">),</span>size<span class="op">[</span>x<span class="op">]+=</span>size<span class="op">[</span>y<span class="op">],</span>hson<span class="op">[</span>x<span class="op">]=(</span>size<span class="op">[</span>y<span class="op">]&gt;</span>size<span class="op">[</span>hson<span class="op">[</span>x<span class="op">]]?</span>y<span class="op">:</span>hson<span class="op">[</span>x<span class="op">]);</span></span>
<span id="cb3-146"><a href="#cb3-146" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span><span class="op">;</span></span>
<span id="cb3-147"><a href="#cb3-147" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb3-148"><a href="#cb3-148" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> dfs2<span class="op">(</span><span class="dt">int</span> x<span class="op">,</span><span class="dt">int</span> root<span class="op">)</span></span>
<span id="cb3-149"><a href="#cb3-149" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb3-150"><a href="#cb3-150" aria-hidden="true" tabindex="-1"></a>    <span class="at">register</span> <span class="dt">int</span> i<span class="op">;</span></span>
<span id="cb3-151"><a href="#cb3-151" aria-hidden="true" tabindex="-1"></a>    id<span class="op">[</span>x<span class="op">]=++</span>idx<span class="op">;</span>di<span class="op">[</span>idx<span class="op">]=</span>x<span class="op">;</span>top<span class="op">[</span>x<span class="op">]=</span>root<span class="op">;</span></span>
<span id="cb3-152"><a href="#cb3-152" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span><span class="op">(</span>hson<span class="op">[</span>x<span class="op">])</span></span>
<span id="cb3-153"><a href="#cb3-153" aria-hidden="true" tabindex="-1"></a>        dfs2<span class="op">(</span>hson<span class="op">[</span>x<span class="op">],</span>root<span class="op">);</span></span>
<span id="cb3-154"><a href="#cb3-154" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb3-155"><a href="#cb3-155" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span><span class="op">(</span>i<span class="op">=</span>x<span class="op">;</span>i<span class="op">!=</span>father<span class="op">[</span>top<span class="op">[</span>x<span class="op">]];</span>i<span class="op">=</span>father<span class="op">[</span>i<span class="op">])</span></span>
<span id="cb3-156"><a href="#cb3-156" aria-hidden="true" tabindex="-1"></a>            bot<span class="op">[</span>i<span class="op">]=</span>x<span class="op">;</span></span>
<span id="cb3-157"><a href="#cb3-157" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(</span><span class="dt">int</span> y<span class="op">:</span>e<span class="op">[</span>x<span class="op">])</span></span>
<span id="cb3-158"><a href="#cb3-158" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span><span class="op">(</span>y<span class="op">!=</span>father<span class="op">[</span>x<span class="op">]&amp;&amp;</span>y<span class="op">!=</span>hson<span class="op">[</span>x<span class="op">])</span></span>
<span id="cb3-159"><a href="#cb3-159" aria-hidden="true" tabindex="-1"></a>            dfs2<span class="op">(</span>y<span class="op">,</span>y<span class="op">);</span></span>
<span id="cb3-160"><a href="#cb3-160" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span><span class="op">;</span></span>
<span id="cb3-161"><a href="#cb3-161" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb3-162"><a href="#cb3-162" aria-hidden="true" tabindex="-1"></a><span class="dt">signed</span> main<span class="op">()</span></span>
<span id="cb3-163"><a href="#cb3-163" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb3-164"><a href="#cb3-164" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> x<span class="op">,</span>y<span class="op">,</span>ptr<span class="op">,</span>cntl<span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-165"><a href="#cb3-165" aria-hidden="true" tabindex="-1"></a>    epc e<span class="op">;</span></span>
<span id="cb3-166"><a href="#cb3-166" aria-hidden="true" tabindex="-1"></a>    <span class="at">register</span> <span class="dt">int</span> i<span class="op">;</span></span>
<span id="cb3-167"><a href="#cb3-167" aria-hidden="true" tabindex="-1"></a>    scanf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%d%d%d</span><span class="st">&quot;</span><span class="op">,&amp;</span>n<span class="op">,&amp;</span>L<span class="op">,&amp;</span>R<span class="op">);</span></span>
<span id="cb3-168"><a href="#cb3-168" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(</span>i<span class="op">=</span><span class="dv">1</span><span class="op">;</span>i<span class="op">&lt;=</span>n<span class="op">-</span><span class="dv">1</span><span class="op">;</span>i<span class="op">++)</span></span>
<span id="cb3-169"><a href="#cb3-169" aria-hidden="true" tabindex="-1"></a>        scanf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%d%d</span><span class="st">&quot;</span><span class="op">,&amp;</span>x<span class="op">,&amp;</span>y<span class="op">),::</span>e<span class="op">[</span>x<span class="op">].</span>push_back<span class="op">(</span>y<span class="op">),::</span>e<span class="op">[</span>y<span class="op">].</span>push_back<span class="op">(</span>x<span class="op">);</span></span>
<span id="cb3-170"><a href="#cb3-170" aria-hidden="true" tabindex="-1"></a>    dfs<span class="op">(</span><span class="dv">1</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb3-171"><a href="#cb3-171" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(</span>i<span class="op">=</span><span class="dv">1</span><span class="op">;</span>i<span class="op">&lt;=</span>n<span class="op">;</span>i<span class="op">++)</span></span>
<span id="cb3-172"><a href="#cb3-172" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span><span class="op">(</span>isl<span class="op">[</span>i<span class="op">])</span></span>
<span id="cb3-173"><a href="#cb3-173" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb3-174"><a href="#cb3-174" aria-hidden="true" tabindex="-1"></a>            cntl<span class="op">++;</span></span>
<span id="cb3-175"><a href="#cb3-175" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span><span class="op">(</span>i<span class="op">&lt;</span>key<span class="op">[</span><span class="dv">1</span><span class="op">])</span></span>
<span id="cb3-176"><a href="#cb3-176" aria-hidden="true" tabindex="-1"></a>                low<span class="op">.</span>push_back<span class="op">(</span>i<span class="op">);</span></span>
<span id="cb3-177"><a href="#cb3-177" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span> <span class="cf">if</span><span class="op">(</span>i<span class="op">==</span>key<span class="op">[</span><span class="dv">1</span><span class="op">])</span></span>
<span id="cb3-178"><a href="#cb3-178" aria-hidden="true" tabindex="-1"></a>                ex<span class="op">.</span>push_back<span class="op">(</span>i<span class="op">);</span></span>
<span id="cb3-179"><a href="#cb3-179" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span></span>
<span id="cb3-180"><a href="#cb3-180" aria-hidden="true" tabindex="-1"></a>                high<span class="op">.</span>push_back<span class="op">(</span>i<span class="op">);</span></span>
<span id="cb3-181"><a href="#cb3-181" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb3-182"><a href="#cb3-182" aria-hidden="true" tabindex="-1"></a>    dfs1<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb3-183"><a href="#cb3-183" aria-hidden="true" tabindex="-1"></a>    dfs2<span class="op">(</span><span class="dv">1</span><span class="op">,</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb3-184"><a href="#cb3-184" aria-hidden="true" tabindex="-1"></a>    zkw<span class="op">::</span>init<span class="op">(</span>n<span class="op">);</span></span>
<span id="cb3-185"><a href="#cb3-185" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(</span>i<span class="op">=</span><span class="dv">1</span><span class="op">;</span>i<span class="op">&lt;=</span>n<span class="op">;</span>i<span class="op">++)</span></span>
<span id="cb3-186"><a href="#cb3-186" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span><span class="op">(</span>isl<span class="op">[</span>i<span class="op">])</span></span>
<span id="cb3-187"><a href="#cb3-187" aria-hidden="true" tabindex="-1"></a>            dp<span class="op">[</span>i<span class="op">]=(</span>key<span class="op">[</span>i<span class="op">]&gt;</span>key<span class="op">[</span><span class="dv">1</span><span class="op">])?((</span>deep<span class="op">[</span>i<span class="op">]&amp;</span><span class="dv">1</span><span class="op">)?</span><span class="dv">0</span><span class="op">:</span><span class="dv">1</span><span class="op">):((</span>deep<span class="op">[</span>i<span class="op">]&amp;</span><span class="dv">1</span><span class="op">)?</span><span class="dv">1</span><span class="op">:</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb3-188"><a href="#cb3-188" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span>
<span id="cb3-189"><a href="#cb3-189" aria-hidden="true" tabindex="-1"></a>            dp<span class="op">[</span>i<span class="op">]=</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb3-190"><a href="#cb3-190" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(</span>i<span class="op">=</span>n<span class="op">;</span>i<span class="op">&gt;=</span><span class="dv">1</span><span class="op">;</span>i<span class="op">--)</span></span>
<span id="cb3-191"><a href="#cb3-191" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb3-192"><a href="#cb3-192" aria-hidden="true" tabindex="-1"></a>        zkw<span class="op">::</span>modify<span class="op">(</span>i<span class="op">,</span>epc<span class="op">(</span>sub<span class="op">(</span><span class="dv">0</span><span class="op">,</span>dp<span class="op">[</span>di<span class="op">[</span>i<span class="op">]].</span>to_int<span class="op">()),</span>dp<span class="op">[</span>di<span class="op">[</span>i<span class="op">]].</span>to_int<span class="op">()));</span></span>
<span id="cb3-193"><a href="#cb3-193" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span><span class="op">(</span>i<span class="op">&gt;</span><span class="dv">1</span><span class="op">&amp;&amp;</span>top<span class="op">[</span>di<span class="op">[</span>i<span class="op">]]==</span>di<span class="op">[</span>i<span class="op">])</span></span>
<span id="cb3-194"><a href="#cb3-194" aria-hidden="true" tabindex="-1"></a>            e<span class="op">=</span>zkw<span class="op">::</span>query<span class="op">(</span>i<span class="op">,</span>id<span class="op">[</span>bot<span class="op">[</span>di<span class="op">[</span>i<span class="op">]]]),</span>dp<span class="op">[</span>father<span class="op">[</span>di<span class="op">[</span>i<span class="op">]]]=</span>dp<span class="op">[</span>father<span class="op">[</span>di<span class="op">[</span>i<span class="op">]]]*</span>sub<span class="op">(</span><span class="dv">1</span><span class="op">,</span>e<span class="op">.</span>b<span class="op">);</span></span>
<span id="cb3-195"><a href="#cb3-195" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb3-196"><a href="#cb3-196" aria-hidden="true" tabindex="-1"></a>    sort<span class="op">(</span>low<span class="op">.</span>begin<span class="op">(),</span>low<span class="op">.</span>end<span class="op">(),</span>greater<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;());</span></span>
<span id="cb3-197"><a href="#cb3-197" aria-hidden="true" tabindex="-1"></a>    ptr<span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-198"><a href="#cb3-198" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(</span>i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span>n<span class="op">;</span>i<span class="op">++)</span></span>
<span id="cb3-199"><a href="#cb3-199" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb3-200"><a href="#cb3-200" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span><span class="op">(</span>ptr<span class="op">&lt;(</span><span class="dt">int</span><span class="op">)</span>low<span class="op">.</span>size<span class="op">()&amp;&amp;</span>key<span class="op">[</span><span class="dv">1</span><span class="op">]+</span><span class="dv">1</span><span class="op">-</span>low<span class="op">[</span>ptr<span class="op">]&lt;=</span>i<span class="op">)</span></span>
<span id="cb3-201"><a href="#cb3-201" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb3-202"><a href="#cb3-202" aria-hidden="true" tabindex="-1"></a>            x<span class="op">=</span>low<span class="op">[</span>ptr<span class="op">];</span></span>
<span id="cb3-203"><a href="#cb3-203" aria-hidden="true" tabindex="-1"></a>            dp<span class="op">[</span>x<span class="op">]=</span>inv2<span class="op">;</span></span>
<span id="cb3-204"><a href="#cb3-204" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span><span class="op">(</span>x<span class="op">)</span></span>
<span id="cb3-205"><a href="#cb3-205" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb3-206"><a href="#cb3-206" aria-hidden="true" tabindex="-1"></a>                e<span class="op">=</span>zkw<span class="op">::</span>query<span class="op">(</span>id<span class="op">[</span>top<span class="op">[</span>x<span class="op">]],</span>id<span class="op">[</span>bot<span class="op">[</span>x<span class="op">]]);</span></span>
<span id="cb3-207"><a href="#cb3-207" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span><span class="op">(</span>father<span class="op">[</span>top<span class="op">[</span>x<span class="op">]])</span></span>
<span id="cb3-208"><a href="#cb3-208" aria-hidden="true" tabindex="-1"></a>                    dp<span class="op">[</span>father<span class="op">[</span>top<span class="op">[</span>x<span class="op">]]]=</span>dp<span class="op">[</span>father<span class="op">[</span>top<span class="op">[</span>x<span class="op">]]]/</span>sub<span class="op">(</span><span class="dv">1</span><span class="op">,</span>e<span class="op">.</span>b<span class="op">);</span></span>
<span id="cb3-209"><a href="#cb3-209" aria-hidden="true" tabindex="-1"></a>                zkw<span class="op">::</span>modify<span class="op">(</span>id<span class="op">[</span>x<span class="op">],</span>epc<span class="op">(</span>sub<span class="op">(</span><span class="dv">0</span><span class="op">,</span>dp<span class="op">[</span>x<span class="op">].</span>to_int<span class="op">()),</span>dp<span class="op">[</span>x<span class="op">].</span>to_int<span class="op">()));</span></span>
<span id="cb3-210"><a href="#cb3-210" aria-hidden="true" tabindex="-1"></a>                e<span class="op">=</span>zkw<span class="op">::</span>query<span class="op">(</span>id<span class="op">[</span>top<span class="op">[</span>x<span class="op">]],</span>id<span class="op">[</span>bot<span class="op">[</span>x<span class="op">]]);</span></span>
<span id="cb3-211"><a href="#cb3-211" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span><span class="op">(</span>father<span class="op">[</span>top<span class="op">[</span>x<span class="op">]])</span></span>
<span id="cb3-212"><a href="#cb3-212" aria-hidden="true" tabindex="-1"></a>                    dp<span class="op">[</span>father<span class="op">[</span>top<span class="op">[</span>x<span class="op">]]]=</span>dp<span class="op">[</span>father<span class="op">[</span>top<span class="op">[</span>x<span class="op">]]]*</span>sub<span class="op">(</span><span class="dv">1</span><span class="op">,</span>e<span class="op">.</span>b<span class="op">);</span></span>
<span id="cb3-213"><a href="#cb3-213" aria-hidden="true" tabindex="-1"></a>                x<span class="op">=</span>father<span class="op">[</span>top<span class="op">[</span>x<span class="op">]];</span></span>
<span id="cb3-214"><a href="#cb3-214" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb3-215"><a href="#cb3-215" aria-hidden="true" tabindex="-1"></a>            ptr<span class="op">++;</span></span>
<span id="cb3-216"><a href="#cb3-216" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb3-217"><a href="#cb3-217" aria-hidden="true" tabindex="-1"></a>        e<span class="op">=</span>zkw<span class="op">::</span>query<span class="op">(</span><span class="dv">1</span><span class="op">,</span>id<span class="op">[</span>bot<span class="op">[</span><span class="dv">1</span><span class="op">]]);</span></span>
<span id="cb3-218"><a href="#cb3-218" aria-hidden="true" tabindex="-1"></a>        ansf<span class="op">[</span>i<span class="op">]=</span>sub<span class="op">(</span><span class="dv">1</span><span class="op">,</span>e<span class="op">.</span>b<span class="op">);</span></span>
<span id="cb3-219"><a href="#cb3-219" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb3-220"><a href="#cb3-220" aria-hidden="true" tabindex="-1"></a>    ansf<span class="op">[</span>n<span class="op">]=</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb3-221"><a href="#cb3-221" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(</span>i<span class="op">=</span><span class="dv">1</span><span class="op">;</span>i<span class="op">&lt;=</span>n<span class="op">;</span>i<span class="op">++)</span></span>
<span id="cb3-222"><a href="#cb3-222" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span><span class="op">(</span>isl<span class="op">[</span>i<span class="op">])</span></span>
<span id="cb3-223"><a href="#cb3-223" aria-hidden="true" tabindex="-1"></a>            dp<span class="op">[</span>i<span class="op">]=(</span>key<span class="op">[</span>i<span class="op">]&lt;</span>key<span class="op">[</span><span class="dv">1</span><span class="op">])?((</span>deep<span class="op">[</span>i<span class="op">]&amp;</span><span class="dv">1</span><span class="op">)?</span><span class="dv">1</span><span class="op">:</span><span class="dv">0</span><span class="op">):((</span>deep<span class="op">[</span>i<span class="op">]&amp;</span><span class="dv">1</span><span class="op">)?</span><span class="dv">0</span><span class="op">:</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb3-224"><a href="#cb3-224" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span>
<span id="cb3-225"><a href="#cb3-225" aria-hidden="true" tabindex="-1"></a>            dp<span class="op">[</span>i<span class="op">]=</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb3-226"><a href="#cb3-226" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(</span>i<span class="op">=</span>n<span class="op">;</span>i<span class="op">&gt;=</span><span class="dv">1</span><span class="op">;</span>i<span class="op">--)</span></span>
<span id="cb3-227"><a href="#cb3-227" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb3-228"><a href="#cb3-228" aria-hidden="true" tabindex="-1"></a>        zkw<span class="op">::</span>modify<span class="op">(</span>i<span class="op">,</span>epc<span class="op">(</span>sub<span class="op">(</span><span class="dv">0</span><span class="op">,</span>dp<span class="op">[</span>di<span class="op">[</span>i<span class="op">]].</span>to_int<span class="op">()),</span>dp<span class="op">[</span>di<span class="op">[</span>i<span class="op">]].</span>to_int<span class="op">()));</span></span>
<span id="cb3-229"><a href="#cb3-229" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span><span class="op">(</span>i<span class="op">&gt;</span><span class="dv">1</span><span class="op">&amp;&amp;</span>top<span class="op">[</span>di<span class="op">[</span>i<span class="op">]]==</span>di<span class="op">[</span>i<span class="op">])</span></span>
<span id="cb3-230"><a href="#cb3-230" aria-hidden="true" tabindex="-1"></a>            e<span class="op">=</span>zkw<span class="op">::</span>query<span class="op">(</span>i<span class="op">,</span>id<span class="op">[</span>bot<span class="op">[</span>di<span class="op">[</span>i<span class="op">]]]),</span>dp<span class="op">[</span>father<span class="op">[</span>di<span class="op">[</span>i<span class="op">]]]=</span>dp<span class="op">[</span>father<span class="op">[</span>di<span class="op">[</span>i<span class="op">]]]*</span>sub<span class="op">(</span><span class="dv">1</span><span class="op">,</span>e<span class="op">.</span>b<span class="op">);</span></span>
<span id="cb3-231"><a href="#cb3-231" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb3-232"><a href="#cb3-232" aria-hidden="true" tabindex="-1"></a>    sort<span class="op">(</span>high<span class="op">.</span>begin<span class="op">(),</span>high<span class="op">.</span>end<span class="op">());</span></span>
<span id="cb3-233"><a href="#cb3-233" aria-hidden="true" tabindex="-1"></a>    ptr<span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-234"><a href="#cb3-234" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(</span>i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span>n<span class="op">;</span>i<span class="op">++)</span></span>
<span id="cb3-235"><a href="#cb3-235" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb3-236"><a href="#cb3-236" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span><span class="op">(</span>ptr<span class="op">&lt;(</span><span class="dt">int</span><span class="op">)</span>high<span class="op">.</span>size<span class="op">()&amp;&amp;</span>high<span class="op">[</span>ptr<span class="op">]-</span>key<span class="op">[</span><span class="dv">1</span><span class="op">]+</span><span class="dv">1</span><span class="op">&lt;=</span>i<span class="op">)</span></span>
<span id="cb3-237"><a href="#cb3-237" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb3-238"><a href="#cb3-238" aria-hidden="true" tabindex="-1"></a>            x<span class="op">=</span>high<span class="op">[</span>ptr<span class="op">];</span></span>
<span id="cb3-239"><a href="#cb3-239" aria-hidden="true" tabindex="-1"></a>            dp<span class="op">[</span>x<span class="op">]=</span>inv2<span class="op">;</span></span>
<span id="cb3-240"><a href="#cb3-240" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span><span class="op">(</span>x<span class="op">)</span></span>
<span id="cb3-241"><a href="#cb3-241" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb3-242"><a href="#cb3-242" aria-hidden="true" tabindex="-1"></a>                e<span class="op">=</span>zkw<span class="op">::</span>query<span class="op">(</span>id<span class="op">[</span>top<span class="op">[</span>x<span class="op">]],</span>id<span class="op">[</span>bot<span class="op">[</span>x<span class="op">]]);</span></span>
<span id="cb3-243"><a href="#cb3-243" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span><span class="op">(</span>father<span class="op">[</span>top<span class="op">[</span>x<span class="op">]])</span></span>
<span id="cb3-244"><a href="#cb3-244" aria-hidden="true" tabindex="-1"></a>                    dp<span class="op">[</span>father<span class="op">[</span>top<span class="op">[</span>x<span class="op">]]]=</span>dp<span class="op">[</span>father<span class="op">[</span>top<span class="op">[</span>x<span class="op">]]]/</span>sub<span class="op">(</span><span class="dv">1</span><span class="op">,</span>e<span class="op">.</span>b<span class="op">);</span></span>
<span id="cb3-245"><a href="#cb3-245" aria-hidden="true" tabindex="-1"></a>                zkw<span class="op">::</span>modify<span class="op">(</span>id<span class="op">[</span>x<span class="op">],</span>epc<span class="op">(</span>sub<span class="op">(</span><span class="dv">0</span><span class="op">,</span>dp<span class="op">[</span>x<span class="op">].</span>to_int<span class="op">()),</span>dp<span class="op">[</span>x<span class="op">].</span>to_int<span class="op">()));</span></span>
<span id="cb3-246"><a href="#cb3-246" aria-hidden="true" tabindex="-1"></a>                e<span class="op">=</span>zkw<span class="op">::</span>query<span class="op">(</span>id<span class="op">[</span>top<span class="op">[</span>x<span class="op">]],</span>id<span class="op">[</span>bot<span class="op">[</span>x<span class="op">]]);</span></span>
<span id="cb3-247"><a href="#cb3-247" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span><span class="op">(</span>father<span class="op">[</span>top<span class="op">[</span>x<span class="op">]])</span></span>
<span id="cb3-248"><a href="#cb3-248" aria-hidden="true" tabindex="-1"></a>                    dp<span class="op">[</span>father<span class="op">[</span>top<span class="op">[</span>x<span class="op">]]]=</span>dp<span class="op">[</span>father<span class="op">[</span>top<span class="op">[</span>x<span class="op">]]]*</span>sub<span class="op">(</span><span class="dv">1</span><span class="op">,</span>e<span class="op">.</span>b<span class="op">);</span></span>
<span id="cb3-249"><a href="#cb3-249" aria-hidden="true" tabindex="-1"></a>                x<span class="op">=</span>father<span class="op">[</span>top<span class="op">[</span>x<span class="op">]];</span></span>
<span id="cb3-250"><a href="#cb3-250" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb3-251"><a href="#cb3-251" aria-hidden="true" tabindex="-1"></a>            ptr<span class="op">++;</span></span>
<span id="cb3-252"><a href="#cb3-252" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb3-253"><a href="#cb3-253" aria-hidden="true" tabindex="-1"></a>        e<span class="op">=</span>zkw<span class="op">::</span>query<span class="op">(</span><span class="dv">1</span><span class="op">,</span>id<span class="op">[</span>bot<span class="op">[</span><span class="dv">1</span><span class="op">]]);</span></span>
<span id="cb3-254"><a href="#cb3-254" aria-hidden="true" tabindex="-1"></a>        ansg<span class="op">[</span>i<span class="op">]=</span>e<span class="op">.</span>b<span class="op">;</span></span>
<span id="cb3-255"><a href="#cb3-255" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb3-256"><a href="#cb3-256" aria-hidden="true" tabindex="-1"></a>    ansg<span class="op">[</span>n<span class="op">]=</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb3-257"><a href="#cb3-257" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(</span>i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;=</span>n<span class="op">;</span>i<span class="op">++)</span></span>
<span id="cb3-258"><a href="#cb3-258" aria-hidden="true" tabindex="-1"></a>        ans<span class="op">[</span>i<span class="op">]=</span>sub<span class="op">(</span><span class="dv">1</span><span class="op">,</span>mul<span class="op">(</span>sub<span class="op">(</span><span class="dv">1</span><span class="op">,</span>ansf<span class="op">[</span>i<span class="op">]),</span>sub<span class="op">(</span><span class="dv">1</span><span class="op">,</span>ansg<span class="op">[</span>i<span class="op">])));</span></span>
<span id="cb3-259"><a href="#cb3-259" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>qpow<span class="op">(</span><span class="dv">2</span><span class="op">,</span>cntl<span class="op">-</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb3-260"><a href="#cb3-260" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(</span>i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;=</span>n<span class="op">;</span>i<span class="op">++)</span></span>
<span id="cb3-261"><a href="#cb3-261" aria-hidden="true" tabindex="-1"></a>        ans<span class="op">[</span>i<span class="op">]=</span>mul<span class="op">(</span>ans<span class="op">[</span>i<span class="op">],</span>x<span class="op">);</span></span>
<span id="cb3-262"><a href="#cb3-262" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(</span>i<span class="op">=</span><span class="dv">1</span><span class="op">;</span>i<span class="op">&lt;=</span>n<span class="op">;</span>i<span class="op">++)</span></span>
<span id="cb3-263"><a href="#cb3-263" aria-hidden="true" tabindex="-1"></a>        ans<span class="op">[</span>i<span class="op">]=</span>add<span class="op">(</span>ans<span class="op">[</span>i<span class="op">],</span>x<span class="op">);</span></span>
<span id="cb3-264"><a href="#cb3-264" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(</span>i<span class="op">=</span>n<span class="op">;</span>i<span class="op">&gt;=</span><span class="dv">1</span><span class="op">;</span>i<span class="op">--)</span></span>
<span id="cb3-265"><a href="#cb3-265" aria-hidden="true" tabindex="-1"></a>        ans<span class="op">[</span>i<span class="op">]=</span>sub<span class="op">(</span>ans<span class="op">[</span>i<span class="op">],</span>ans<span class="op">[</span>i<span class="op">-</span><span class="dv">1</span><span class="op">]);</span></span>
<span id="cb3-266"><a href="#cb3-266" aria-hidden="true" tabindex="-1"></a>    ans<span class="op">[</span>n<span class="op">]=</span>sub<span class="op">(</span>ans<span class="op">[</span>n<span class="op">],</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb3-267"><a href="#cb3-267" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(</span>i<span class="op">=</span>L<span class="op">;</span>i<span class="op">&lt;=</span>R<span class="op">;</span>i<span class="op">++)</span></span>
<span id="cb3-268"><a href="#cb3-268" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%d</span><span class="st"> &quot;</span><span class="op">,</span>ans<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb3-269"><a href="#cb3-269" aria-hidden="true" tabindex="-1"></a>    putchar<span class="op">(</span><span class="ch">&#39;</span><span class="sc">\n</span><span class="ch">&#39;</span><span class="op">);</span></span>
<span id="cb3-270"><a href="#cb3-270" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-271"><a href="#cb3-271" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</body>
</html>
